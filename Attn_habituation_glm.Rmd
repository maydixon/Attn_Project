---
title: "Attn_habituation_glm"
author: "May Dixon"
date: "September 21, 2016"
output: html_document
---
trying to push....
## Three main sections
*initial preference*
*rates of habituation*
*discrimination*

## Initial interest
In this section we are assessing which treatments had the highest initial responses (the most twitches in the first "set" of calls for each treatment per bat)

Some results using glm (general linear modelling):
 W/ logged data, from greatest response to least response:
     - Rra mean/sd: 2.2234920 0.2420203, significantly greater than De (0.0205), RRa (p=0.0773)
     - T mean/sd: 1.9824794 0.2325272, not different than anything
   - Tc mean/sd: 1.9764097 0.2325272, not different than anything
   - Ra mean/sd: 1.6645485 0.2420203, barely significantly different from Rra (p=0.0773)
 
   - Rt mean/sd: 1.6540395 0.2420203, almost significantly smaller than Rra (0.0720)
   - Ts mean/sd: 1.5010945 0.2325272, significant;y less than rra (0.0211)
    - De mean/sd: 1.4977549 0.2325272, only significantly different than Rra (p=0.0205)
    
    The data (line 817 in original): 
```{r}
 attn_int_2 <- read.table("/Users/maydixon/Dropbox/Attention Project/R/attn_for_initial_interest.txt", header=TRUE)
        View(attn_int_2)
        initial_int_1 <-  lme(all_tw_set ~ trial_name_2, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
        summary(initial_int_1)
        levels(attn_set$trial_name_2)
        
        
#initial interest with and without logged data
        # running LME with and without logged data
        # using relevel to find the true value (intercept) for each variable, and what is significantly different from each variable. 
        
         #without:
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"De") #MAKE DE REFERENCE
        nlme_int_rra_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), na.action=na.exclude, data = attn_int_2)
        summary(nlme_int_rra_ref)
        #De is only significantly different than rra (lower)
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Ra") #MAKE RA REFERENCE
        
        nlme_int_ra_ref<- nlme_int_rra_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
        summary(nlme_int_ra_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Rra") #MAKE RRA REFERENCE
        nlme_int_rra_ref<- nlme_int_rra_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
        summary(nlme_int_rra_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Rt") #MAKE RT REFERENCE
        nlme_int_rt_ref<- nlme_int_rra_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
        summary(nlme_int_rt_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"T") #MAKE t_de REFERENCE
        nlme_int_t_de_ref<- nlme_int_rra_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
        summary(nlme_int_t_de_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"tc_ts_tc") #MAKE TC REFERENCE
        nlme_int_tc_ref<- nlme_int_rra_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
        summary(nlme_int_tc_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"ts_tc_ts") #MAKE ts REFERENCE
        nlme_int_ts_ref<- nlme_int_rra_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
        summary(nlme_int_ts_ref)
        #
        
        #with logged data
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"De") #MAKE DE REFERENCE
        
        nlme_int_rra_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), na.action=na.exclude, data = attn_int_2)
        summary(nlme_int_rra_ref)
        #De is only significantly different than rra (lower)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Ra") #MAKE RA REFERENCE
        
        nlme_int_ra_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), na.action=na.exclude, data = attn_int_2)
        summary(nlme_int_ra_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Rra") #MAKE RRA REFERENCE
        nlme_int_rra_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
        summary(nlme_int_rra_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Rt") #MAKE RT REFERENCE
        nlme_int_rt_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
        summary(nlme_int_rt_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"T") #MAKE T REFERENCE
        nlme_int_t_ref<- nlme_int_rra_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
        summary(nlme_int_t_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Tc") #MAKE TC REFERENCE
        nlme_int_tc_ref<- nlme_int_rra_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
        summary(nlme_int_tc_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Ts") #MAKE ts REFERENCE
        nlme_int_ts_ref<- nlme_int_rra_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
        summary(nlme_int_ts_ref)
        
        #reordering for plotting: 
        attn_int_2$first_stim <- factor(attn_int_2$first_stim,levels = c('De','Ra', 'Rra', "Rt", "Ts", "T", "Tc"),ordered = TRUE)
        #perhaps best order is: Ts, T, Tc, Rt, Rra, Ra, De, can do using relevel() commands from above
```




### OK, now redoing the above except with generalized linear mixed model (log-linked), which is more statistically appropriate

```{r}
library(lme4)

 attn_int_2 <- read.table("/Users/maydixon/Dropbox/Attention Project/R/attn_for_initial_interest.txt", header=TRUE)
        head(attn_int_2)
        
        # model: the number of initial twitches is explained by the playback type, with bat id and/ or trial # as a random effect:
        
        initial_int_1 <- glmer(all_tw_set ~ first_stim + (trial_number|Bat_ID), family= "poisson", data = attn_int_2) #model with nested interaction effect
      
       initial_int_2 <- glmer(all_tw_set ~ first_stim + (1|Bat_ID), family= "poisson", data = attn_int_2) #model with nested interaction effect #
        s_ii1 <- summary(initial_int_1)
        s_ii2 <- summary(initial_int_2)
        s_ii1
        s_ii2
        # So, using AIC, using trial number as a nested random effect with batID is a slightly better model than Bat_ID alone
        #I'll use just the first model initial_int_1 from here on out. 
```
So this model is best:  initial_int_1 <- glmer(all_tw_set ~ trial_name_2 + (trial_number|Bat_ID), family= "poisson", data = attn_int_2) 
   
```{r}
        
#continuing to run initial interest with glmer 
        levels(attn_set$trial_name_2)
        initial_int_1 <- glmer(all_tw_set ~ first_stim + (trial_number|Bat_ID), family= "poisson", data = attn_int_2) #model with nested interaction effect
        
# running glmer with and without logged data
# using relevel to find the true value (intercept) for each variable, and what is significantly different from each variable. 
        
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"De") #MAKE DE REFERENCE
        nlme_int_de_ref<- glmer(all_tw_set ~ first_stim + (trial_number|Bat_ID), family= "poisson", data = attn_int_2)
        summary(nlme_int_de_ref)
        #De is only significantly different than rra (lower)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Ra") #MAKE RA REFERENCE
        nlme_int_ra_ref<- glmer(all_tw_set ~ first_stim + (trial_number|Bat_ID), family= "poisson", data = attn_int_2)
        summary(nlme_int_ra_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Rra") #MAKE RRA REFERENCE
        nlme_int_rra_ref<- glmer(all_tw_set ~ first_stim + (trial_number|Bat_ID), family= "poisson", data = attn_int_2)
        summary(nlme_int_rra_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Rt") #MAKE RT REFERENCE
        nlme_int_rt_ref<- glmer(all_tw_set ~ first_stim + (trial_number|Bat_ID), family= "poisson", data = attn_int_2)
        summary(nlme_int_rt_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"T") #MAKE T REFERENCE
        nlme_int_t_de_ref<- glmer(all_tw_set ~ first_stim + (trial_number|Bat_ID), family= "poisson", data = attn_int_2)
        summary(nlme_int_t_de_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"TC") #MAKE TC REFERENCE
        nlme_int_tc_ref<- glmer(all_tw_set ~ first_stim + (trial_number|Bat_ID), family= "poisson", data = attn_int_2)
        summary(nlme_int_tc_ref)
        
        attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"TS") #MAKE ts REFERENCE
        nlme_int_ts_ref<- glmer(all_tw_set ~ first_stim + (trial_number|Bat_ID), family= "poisson", data = attn_int_2)
        summary(nlme_int_ts_ref)
        #
        
        
        #perhaps best order is: Ts, T, Tc, Rt, Rra, Ra, De, can do using relevel() commands from above
```


Then plotting those data: 
```{r}
library(plotly)
library(nlme)
library(lme4)
#code for above
 attn_int_2 <- read.table("/Users/maydixon/Dropbox/Attention Project/R/attn_for_initial_interest_w_na.rm.txt", header=TRUE)
    attn_int_2<-subset(attn_int_2, attn_int_2$bat_name != "Blackbeard") #removes unresponsive bat)
    #find first time experiencing tungara (first), use that
head(attn_int_2)
#how is this variable distributed?
hist(attn_int_2$all_tw_set, breaks=10)
hist(log(attn_int_2$all_tw_set))
#These data look way better when normalized with log
library(ggplot2)

#Should I make variable normal?

#plotted after
#boxplot(data=attn_int_2, all_tw_set~Bat_ID)
###### running LME with and without logged data
#without:
attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"De") #MAKE DE REFERENCE
nlme_int_de_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), na.action=na.exclude, data = attn_int_2)
summary(nlme_int_de_ref)
#glm_int_de_ref<- glmer(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), family="poisson", na.action=na.exclude, data = attn_int_2)
#^don't know how to do glmer
#De is only significantly different than rra (lower)
attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Ra") #MAKE RA REFERENCE

nlme_int_ra_ref<- nlme_int_rra_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
summary(nlme_int_ra_ref)

attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Rra") #MAKE RRA REFERENCE
nlme_int_rra_ref<- nlme_int_rra_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
summary(nlme_int_rra_ref)

attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Rt") #MAKE RT REFERENCE
nlme_int_rt_ref<- nlme_int_rra_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
summary(nlme_int_rt_ref)

attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"T") #MAKE t_de REFERENCE
nlme_int_t_de_ref<- nlme_int_rra_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
summary(nlme_int_t_de_ref)

attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Tc") #MAKE TC REFERENCE
nlme_int_tc_ref<- nlme_int_rra_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
summary(nlme_int_tc_ref)

attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Ts") #MAKE ts REFERENCE
nlme_int_ts_ref<- nlme_int_rra_ref<- lme(all_tw_set ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
summary(nlme_int_ts_ref)
#

#with logged data

attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"De") #MAKE DE REFERENCE

nlme_int_rra_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), na.action=na.exclude, data = attn_int_2)
summary(nlme_int_rra_ref)
#De is only significantly different than rra (lower)

attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Ra") #MAKE RA REFERENCE

 nlme_int_ra_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), na.action=na.exclude, data = attn_int_2)
summary(nlme_int_ra_ref)

attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Rra") #MAKE RRA REFERENCE
 nlme_int_rra_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
summary(nlme_int_rra_ref)

attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Rt") #MAKE RT REFERENCE
nlme_int_rt_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
summary(nlme_int_rt_ref)

attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"T") #MAKE T REFERENCE
nlme_int_t_ref<- nlme_int_rra_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
summary(nlme_int_t_ref)

attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Tc") #MAKE TC REFERENCE
nlme_int_tc_ref<- nlme_int_rra_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
summary(nlme_int_tc_ref)

attn_int_2$first_stim <- relevel(attn_int_2$first_stim,"Ts") #MAKE ts REFERENCE
nlme_int_ts_ref<- nlme_int_rra_ref<- lme(log(all_tw_set+1) ~ first_stim, random = list(Bat_ID=~1, trial_number= ~1), data = attn_int_2)
summary(nlme_int_ts_ref)

#reordering for plotting: 
      attn_int_2$first_stim <- factor(attn_int_2$first_stim,levels = c('De','Ra', 'Rra', "Rt", "Ts", "T", "Tc"),ordered = TRUE)
#perhaps best order is: Ts, T, Tc, Rt, Rra, Ra, De, can do using relevel() commands from above

      #plots
      library(plotly)
      attn_int_2$md_lg_tw_set<- attn_int_2$md_tw_set + attn_int_2$lg_tw_set
#with logged +1 (for zero) data
p <- ggplot(data = attn_int_2, aes(x = first_stim, y = log(all_tw_set+1), fill=first_stim))
p <- p + geom_boxplot()
p <- p + theme(axis.text.x = element_text(angle = 90))
p <- p + xlab("Acoustic stimuli")
p <- p + ylab("log( twitches in first set)")
p

#with unlogged data
p <- ggplot(data = attn_int_2, aes(x = first_stim, y = all_tw_set, fill=first_stim))
p <- p + geom_boxplot()
p <- p + theme(axis.text.x = element_text(angle = 90))
p <- p + ylab("twitches in first set")
p + xlab("Acoustic stimuli")
p
```

#Habituation

Code and models: 
```{r}
 #web
        attn_habit_3<-read.table("https://raw.githubusercontent.com/maydixon/Attn_Project/master/attn_habit_1.txt", sep="\t", header=TRUE)
        library(nlme)

        View(attn_habit_3)
        #glm for all twitches with an interaction between call number and trial name as main effect, bat ID as random effect, for all twitches
        nlme_int <- lme(all_tw_call ~ call_num*trial_name_2, random = ~1|Bat_ID, data= attn_habit_3) # does glm
       
        sum_lme<- summary(nlme_int)
        sum_lme
        
        #glm for medium and large twitches with  an interaction between call number and trial name as main effect, bat ID as random effect
        nlme_int2 <- lme(mdlg_tw_call ~ call_num*trial_name_2, random = ~1|Bat_ID, data= attn_habit_3) # does glm
        sum_lme2<- summary(nlme_int)
        sum_lme2
        
        # can I explain any more of the variation by including trial number as a random variable? or a fixed for that matter...
        # glm for all twitches with  an interaction between call number and trial name as main effect, bat ID *and trial number* as random effect
        # work on this, right now the way I am calling random isn't right 
        nlme_int3 <- lme(all_tw_call ~ call_num*trial_name_2, random = list(Bat_ID=~1 , trial_number= ~1), data= attn_habit_3) # does glm
        sum_lme3<- summary(nlme_int3)
        sum_lme3
        
       
```

But really, several things. 

1) a Generalized linear mixed model would be better, bc this is technically "count" data and it seems to follow more of a poisson distribution than a normal districution, dispite the large number of cases. 
2) Using model selection would be better, to really formally see whether adding trial number and bat ID as random effects makes the model better, not to mention the relationship between call number nad trial name. Would also be good to try trial number as a fixed effect.  

study tells me that stepwise model selection isn't always a great idea. i should start with common sense (why do I think these variables are important?), and then make a few models and then compare them, using AIC, for example. Most likely they won't be radically different

possible models built on "substantive sense"

```{r}
#1. twitches ~ call num + call_num:trial_name , random = bat_ID  # main effect of call number and interaction of call and trial, one random

#2. twitches ~ call num + call_num:trial_name , random = bat_ID , trial_number (nested in bat_ID)   # this would remove trial name in and of itself had an impact on twitch number
#3.  twitches ~ call_num * trial_name random = bat_ID 
#4.  twitches ~ call_num * trial_name random = bat_ID , trial_number (nested in bat_ID)
#5.  twitches ~ call_num * trial_name + trial_number random  = bat_ID  #fullest model I think, trial # as main effect 

all_tw_call ~ call_num*trial_name_2, random = list(Bat_ID=~1 , trial_number= ~1), data= attn_habit_3

#make models
#
attn_habit_3<-read.table("https://raw.githubusercontent.com/maydixon/Attn_Project/master/attn_habit_1.txt", sep="\t", header=TRUE)
library(nlme)
library(lme4)
d<- attn_habit_3 
head(d)

 #1 twitches ~ call num + call_num:trial_name , random = bat_ID  # main effect of call number and interaction of call and trial, one random
m1<- glmer(all_tw_call ~ call_num + call_num:trial_name_2 + (1|Bat_ID), data= attn_habit_3, family="poisson")
sm1<- summary(m1)
sm1
#2. twitches ~ call num + call_num:trial_name , random = bat_ID , trial_number (nested in bat_ID)   # this would remove trial name in and of itself had an impact on twitch number
m2<- glmer(all_tw_call ~ call_num + call_num:trial_name_2 + (trial_number| Bat_ID), data= attn_habit_3, family="poisson")
summary(m2)
sm2<- summary(m2)
#2.5 #this adds call number as a main effect, but doesn't include the main effect of trial type
m2_5<- glmer(all_tw_call ~ call_num + call_num:trial_name_2 + trial_number + (1| Bat_ID), data= attn_habit_3, family="poisson")
sm25<- summary(m2_5)
sm25

#past here model fails to converge

#3.  twitches ~ call_num * trial_name random = bat_ID 
m3<- glmer(all_tw_call ~ call_num *trial_name_2  + (1| Bat_ID), data= attn_habit_3, family="poisson")

#4.  twitches ~ call_num * trial_name random = bat_ID , trial_number (nested in bat_ID)
m4<- glmer(all_tw_call ~ call_num *trial_name_2  + (trial_number| Bat_ID), data= attn_habit_3, family="poisson")

#5 twitches ~ call_num * trial_name + trial_number random  = bat_ID  #fullest model I think, trial # as main effect ((WHICH HAS LOWEST AIC?, WHICH MAKES MOST SENSE))
m5<- glmer(all_tw_call ~ call_num *trial_name_2 +trial_number + (1| Bat_ID), data= attn_habit_3, family="poisson") 
```

Ok, so we know that more complex models, any that include trial_name trial_name as a main effect fail to converge. So which of the three models (m1, m2, and m2_5) explains the data best?

I can 1) quickly look at the relative AIC's of each model. The lower AIC's are liable to be better. 2) run partial F tests to test more full models to more reduced models. 

Comparing AIC:
```{r}
#comparing AIC's of each model
AIC_comp<-cbind(sm1$AICtab, sm2$AICtab, sm25$AICtab)
colnames(AIC_comp)<-(c("sm1", "sm2", "sm25"))
AIC_comp
```

So model 2 has the lowest AIC. Is it significantly better? Can run a partial F test: 
```{r}
#nested F test to test models. 
anova(m2_5, m2,  test="F") #compares the reduced model trial name as a random factor to full model with trial_name as main effect
# I think that this shows that model 2 has more explanatory power
anova(m1, m2, test = "F")

# model 2 has the most explanatory power. 


```

So, it seems that model #2 explains the data best: [ twitches ~ call num + call_num:trial_name , random = bat_ID , trial_number (nested in bat_ID) ]


That said, what does model 2 tell us? 

```{r}

sm2
sm2$coefficients
sm2$coefficients[1,1]

```
This is the estimate for the slope of responses to dendropsophes. It is different than tungara complex, but not different than anything else

So, the way to interpret this is: 
The *intercept* is the number of twitches at call 0, for whatever the reference is. Pretty similar for all the treatments. 
The *slope* value for call number is the main effect of change in the number of twitches with time, with all the differences compared against the reference value. 

To find the slopes of each of the other treatments and how they differ from call number, add the interaction effect to the effect for call number to get the true value. Relevel to get the one that is the current reference. 

To see whether there is a significant difference between treatments, relevel, and see what the values are. These are kind of complicated with glmm, so don't read into them everything. 

This is a sheet with a summary of the slopes of the results:

```{r}

#making a little sheet to store results # Don't run again, I just scrolled through manually
#tmts<- c("call_num", "de", "ra", "rra", "rt", "t_de", "t_ra", "tc", "tia", "ts")
attn_habit_3$trial_name_2 <- relevel(attn_habit_3$trial_name_2,"de_t_de") #MAKE DE REFERENCE
m2<- glmer(all_tw_call ~ call_num + call_num:trial_name_2 + (trial_number| Bat_ID), data= attn_habit_3, family="poisson") #run model
sm2<- summary(m2)  #make summary
slope_coeff<- c(sm2$coefficients[,1]) #grab row with the coefficients
slope_est <- slope_coeff + (sm2$coefficients[2,1]) #add the interactions to call# coeff
slopes <- cbind(slope_coeff, slope_est) #make into a sheet
slopes<- slopes[3:10,] #remove the first two rows that don't make sense
attn_habit_3$trial_name_2 <- relevel(attn_habit_3$trial_name_2,"ra_t_ra") #MAKE RA REFERENCE so that DE interaction coefficients show in output
m2a<- glmer(all_tw_call ~ call_num + call_num:trial_name_2 + (trial_number| Bat_ID), data= attn_habit_3, family="poisson") #run model again
sm2a<- summary(m2a)  #make summary
de_coeff_est<-  c(sm2a$coefficients[3,1]) #pull de coefficient
de_slope_est<- de_coeff_est+ sm2a$coefficients[2,1]  #add call num to de coefficient
de_row<- cbind(de_coeff_est, de_slope_est) #put into row
slopes<-rbind(slopes, de_row) #add de row to rest of it 
rownames(slopes) [9] <- "call_num:trial_name_2de_t_de" #add the de row name

slopes #returns the slope estimations (in the second row, for each of the treatments)
 #So, which are significantly different?
 #copying and pasting into an excel doc. 
```

This is s series of "relevels" to show which slopes are significantly different from each other according to this model. To run, simply run the line with the relevel function of the treatment you would like to make reference, and then run the line with the model and summary: 
```{r}
#relevel lines
#DE as reference:
attn_habit_3$trial_name_2 <- relevel(attn_habit_3$trial_name_2,"de_t_de") 
#RA as reference: 
attn_habit_3$trial_name_2 <- relevel(attn_habit_3$trial_name_2,"ra_t_ra") 
#RRA as reference:
attn_habit_3$trial_name_2 <- relevel(attn_habit_3$trial_name_2,"rra_rt_rra") 
#TS as reference:
attn_habit_3$trial_name_2 <- relevel(attn_habit_3$trial_name_2,"ts_tc_ts") 
#TIA as reference:
attn_habit_3$trial_name_2 <- relevel(attn_habit_3$trial_name_2,"tia_tib_tia") 
#TC as reference:
attn_habit_3$trial_name_2 <- relevel(attn_habit_3$trial_name_2,"tc_ts_tc")
#T_RA as reference:
attn_habit_3$trial_name_2 <- relevel(attn_habit_3$trial_name_2,"t_ra_t")
#T_DE as reference:
attn_habit_3$trial_name_2 <- relevel(attn_habit_3$trial_name_2,"t_de_t")
#RT as reference:
attn_habit_3$trial_name_2 <- relevel(attn_habit_3$trial_name_2,"rt_rra_rt")


#model running lines:
m2<- glmer(all_tw_call ~ call_num + call_num:trial_name_2 + (trial_number| Bat_ID), data= attn_habit_3, family="poisson") #run model
sm2<- summary(m2)  #make summary
sm2

```
So, the below table shows all the the treatments with their slopes, from biggest to smallest, and their tests of significant difference  tests (all ***) denoted by letters. If two treatments share a letter, they were not significantly different (1), and if they do, they were significantly different (0): 

trial_name	slope_coeff	slope_est	sig.dif
call_num:trial_name_2de_t_de	0.45847131	-0.07455272	a
call_num:trial_name_2tc_ts_tc	-0.00334758	-0.07790228	a
call_num:trial_name_2t_de_t	-0.10200029	-0.17655499	b
call_num:trial_name_2tia_tib_tia	-0.11624862	-0.19080332	b
call_num:trial_name_2t_ra_t	-0.13224066	-0.20679536	b
call_num:trial_name_2rt_rra_rt	-0.13963957	-0.21419427	b
call_num:trial_name_2ts_tc_ts	-0.14339025	-0.21794495	b
call_num:trial_name_2rra_rt_rra	-0.27034559	-0.34490029	c
call_num:trial_name_2ra_t_ra	-0.45847568	-0.53303038	d

So, the bats habituated most slowly to the DE and The TC, which makes sense, becuase each of these is quite attractive, and the bats are less likely to be habituated. No difference in the amount that they habituated to DE and TC

bats habituated to all the simpler tungaras at the same rate (sanity check)

Nats habituted to RRA very quickly, and habituated fastest to the reversed rhinella alata. 

So, they did habituate fastest to calls that were less biologically relevent to them. 






## Habituation plots, various: 

```{r}

    # New habituation plots (boxplots)
        
        ## can i make a plot of boxplots for each trial type, all the way across trial?
        attn_whole<-read.table("https://raw.githubusercontent.com/maydixon/Attn_Project/master/attention_Rcopy_individuals_condensed.txt", sep="\t", header=TRUE)
        attn_whole <- subset(attn_whole, attn_whole$bat_name != "Blackbeard") 
        # want just one line for each "set"
        #pull partial string match  x.1 for call number using grep
        attn_whole_set <- attn_whole[grep(".1", attn_whole$call_num), ]
        attn_whole_set1to5 <- subset(attn_whole_set, attn_whole_set$set_num != "6" & attn_whole_set$set_num != "7") #removing last 2 sets
        library(ggplot2)
        
        #all treatments together, overall trend
        
        p_all<-ggplot(data=attn_whole_set_1to5, aes(x = set_num, group=set_num , y = all_tw_set, fill=set_num))      #
        p_all <- p_all + geom_boxplot()
        p_all <- p_all + ylab("Twitches in presentation")
        p_all <- p_all + xlab("presentation number")
        p_all <- p_all + ggtitle("All")
        p_all
        
        
        #making a plot for the entire of one treatment, with each set getting a boxplot
        
        #DE
        de_data<- attn_whole_set_1to5[attn_whole_set_1to5$trial_name_2=="de_t_de", ]       
        p_de <-ggplot(data=de_data, aes(x = set_num, y = all_tw_set))      
        p_de <- p_de + geom_boxplot(aes(fill=factor(set_num)))
        p_de <- p_de + guides(fill=FALSE)
        p_de <- p_de + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c("#F966D5", "#F966D5", "#F966D5", "#F966D5", "#F966D5", "#C39921", "#F966D5"))
        p_de <- p_de + ylab("Twitches in presentation")
        p_de <- p_de + xlab("presentation number")
        p_de<- p_de + labs(title = "D. ebraccatus / P. pustulosus")
        p_de <- p_de + coord_cartesian(ylim = c(0, 25))
        p_de <- p_de + stat_smooth(colour="black", size=0.5, method="lm", se=FALSE ,  data= subset(de_data, de_data$set_num!="6" & de_data$set_num!="7")) 
        p_de
        #try<-subset(de_data, de_data$set_num!="6" & de_data$set_num!="7")
        View(try)
        #made using coloring advice from "http://stackoverflow.com/questions/10805643/ggplot2-add-color-to-boxplot-continuous-value-supplied-to-discrete-scale-er"
        
        
        
        
        
        ### very variable, eh? should check that
        d1<- attn_whole_set_1to5[attn_whole_set_1to5$trial_name_2=="de_t_de", ]
        plot(d1$Bat_ID, d1$all_tw_set )
        #for Rra
        hist(d1$all_tw_set)
        
        
        #t_de
        t_de_data <- attn_whole_set_1to5[attn_whole_set_1to5$trial_name_2=="t_de_t", ]
        p_t_de <-ggplot(data=t_de_data, aes(x = set_num, y = all_tw_set))      
        p_t_de <- p_t_de + geom_boxplot(aes(fill=factor(set_num)))
        p_t_de <- p_t_de + guides(fill=FALSE)
        p_t_de <- p_t_de + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c( "#C39921", "#C39921", "#C39921", "#C39921", "#C39921", "#F966D5", "#C39921"))
        p_t_de <- p_t_de + ylab("Twitches in presentation")
        p_t_de + xlab("presentation number")
        p_t_de <- p_t_de + xlab("presentation number")
        p_t_de<- p_t_de + labs(title = "P. pustulosus / D. ebraccatus")
        p_t_de<- p_t_de + coord_cartesian(ylim = c(0, 25))
        p_t_de <- p_t_de + stat_smooth(colour="black", size=0.5, method="lm", se=FALSE ,  data= subset(t_de_data, t_de_data$set_num!="6" & t_de_data$set_num!="7")) 
        p_t_de
        
        
        #rra
        rra_data<- attn_whole_set_1to5[attn_whole_set_1to5$trial_name_2=="rra_rt_rra", ]
        p_rra <-ggplot(data=rra_data, aes(x = set_num, y = all_tw_set))      
        p_rra <- p_rra + geom_boxplot(aes(fill=factor(set_num)))
        p_rra <- p_rra + guides(fill=FALSE)
        #P_rra<- p_rra + coord_cartesian(ylim = c(0, 20)
        p_rra <- p_rra + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c( "#1EB7E9","#1EB7E9", "#1EB7E9","#1EB7E9","#1EB7E9","#1EBF95","#1EB7E9" ))
        p_rra <- p_rra + ylab("Twitches in presentation")
        p_rra + xlab("presentation number")
        p_rra <- p_rra + xlab("presentation number")
        p_rra<- p_rra + labs(title="Reversed R. alata / Reversed P. pustulosus")
        p_rra<- p_rra  + coord_cartesian(ylim = c(0, 25))
        p_rra <- p_rra + stat_smooth(colour="black", size=0.5, method="lm", se=FALSE ,  data= subset(rra_data, rra_data$set_num!="6" & rra_data$set_num!="7")) 
        p_rra
        
        
        #ra
        ra_data<- attn_whole_set_1to5[attn_whole_set_1to5$trial_name_2=="ra_t_ra", ]
        p_ra <-ggplot(data=ra_data, aes(x = set_num, y = all_tw_set))      
        p_ra <- p_ra + geom_boxplot(aes(fill=factor(set_num)))
        p_ra <- p_ra + guides(fill=FALSE)
        p_ra <- p_ra + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c( "#A58DFC", "#A58DFC","#A58DFC","#A58DFC","#A58DFC", "#C39921", "#A58DFC" ))
        p_ra <- p_ra + ylab("Twitches in presentation")
        p_ra + xlab("presentation number")
        p_ra <- p_ra + xlab("presentation number")
        p_ra<- p_ra + labs(title="R. alata / P. pustulosus")
        p_ra<- p_ra + coord_cartesian(ylim = c(0, 25)) #sets y limit
        p_ra <- p_ra + stat_smooth(colour="black", size=0.5, method="lm", se=FALSE ,  data= subset(ra_data, ra_data$set_num!="6" & ra_data$set_num!="7")) 
        
        p_ra
        
        
        
        #t_ra
        t_ra_data <- attn_whole_set_1to5[attn_whole_set_1to5$trial_name_2=="t_ra_t", ]
        p_t_ra <-ggplot(data=t_ra_data, aes(x = set_num, y = all_tw_set))      
        p_t_ra <- p_t_ra + geom_boxplot(aes(fill=factor(set_num)))
        p_t_ra <- p_t_ra + guides(fill=FALSE)
        p_t_ra <- p_t_ra + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c(  "#C39921", "#C39921", "#C39921", "#C39921", "#C39921","#A58DFC","#C39921" ))
        p_t_ra <- p_t_ra + ylab("Twitches in presentation")
        p_t_ra + xlab("presentation number")
        p_t_ra <- p_t_ra + xlab("presentation number")
        p_t_ra<- p_t_ra + labs(title="P. pustulosus / R. alata")
        p_t_ra<- p_t_ra + coord_cartesian(ylim = c(0, 25)) #sets y limit
        p_t_ra <- p_t_ra + stat_smooth(colour="black", size=0.5, method="lm", se=FALSE ,  data= subset(t_ra_data, t_ra_data$set_num!="6" & t_ra_data$set_num!="7")) 
        p_t_ra
        
        #rt
        rt_data<- attn_whole_set_1to5[attn_whole_set_1to5$trial_name_2=="t_ra_t", ]
        p_rt <-ggplot(data=rt_data, aes(x = set_num, y = all_tw_set))      
        p_rt <- p_rt + geom_boxplot(aes(fill=factor(set_num)))
        p_rt <- p_rt + guides(fill=FALSE)
        p_rt <- p_rt + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c( "#1EBF95","#1EBF95", "#1EBF95", "#1EBF95", "#1EBF95","#1EB7E9", "#1EBF95" ))
        p_rt <- p_rt + ylab("Twitches in presentation")
        p_rt + xlab("presentation number")
        p_rt <- p_rt + xlab("presentation number")
        p_rt<- p_rt + labs(title="Reversed P. pustulosus / Reversed R. alata")
        p_rt<- p_rt + coord_cartesian(ylim = c(0, 25)) #sets y limit
        p_rt <- p_rt + stat_smooth(colour="black", size=0.5, method="lm", se=FALSE ,  data= subset(rt_data, rt_data$set_num!="6" & rt_data$set_num!="7")) 
        p_rt
        
        
        #tc
        tc_data<- attn_whole_set_1to5[attn_whole_set_1to5$trial_name_2=="tc_ts_tc", ]
        p_tc <-ggplot(data=tc_data, aes(x = set_num, y = all_tw_set))      
        p_tc <- p_tc + geom_boxplot(aes(fill=factor(set_num)))
        p_tc <- p_tc + guides(fill=FALSE)
        p_tc <- p_tc + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c( "#57B21F", "#57B21F","#57B21F","#57B21F","#57B21F", "#F67770", "#57B21F" ))
        p_tc <- p_tc + ylab("Twitches in presentation")
        p_tc + xlab("presentation number")
        p_tc <- p_tc + xlab("presentation number")
        p_tc<- p_tc + labs(title="3 chuck P. pustulosus / simple P. pustulosus")
        p_tc<- p_tc + coord_cartesian(ylim = c(0, 25)) #sets y limit
        p_tc <- p_tc + stat_smooth(colour="black", size=0.5, method="lm", se=FALSE ,  data= subset(tc_data, tc_data$set_num!="6" & tc_data$set_num!="7")) 
        p_tc
        
        #ts
        ts_data<- attn_whole_set_1to5[attn_whole_set_1to5$trial_name_2=="ts_tc_ts", ]
        p_ts <-ggplot(data=ts_data, aes(x = set_num, y = all_tw_set))      
        p_ts <- p_ts + geom_boxplot(aes(fill=factor(set_num)))
        p_ts <- p_ts + guides(fill=FALSE)
        p_ts <- p_ts + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c("#F67770", "#F67770", "#F67770", "#F67770", "#F67770",  "#57B21F", "#F67770" ))
        p_ts <- p_ts + ylab("Twitches in presentation")
        p_ts + xlab("presentation number")
        p_ts <- p_ts + xlab("presentation number")
        p_ts<- p_ts + labs(title="Simple P. pustulosus / 3 chuck P. pustulosus")
        p_ts<- p_ts + coord_cartesian(ylim = c(0, 25)) #sets y limit
        p_ts <- p_ts + stat_smooth(colour="black", size=0.5, method="lm", se=FALSE ,  data= subset(ts_data, ts_data$set_num!="6" & ts_data$set_num!="7")) 
        p_ts
        
        #tia_tib_tia
        tia_data <- attn_whole_set_1to5[attn_whole_set_1to5$trial_name_2=="tia_tib_tia", ]
        p_tia <-ggplot(data=tia_data, aes(x = set_num, y = all_tw_set))      
        p_tia <- p_tia + geom_boxplot(aes(fill=factor(set_num)))
        p_tia <- p_tia + guides(fill=FALSE)
        p_tia <- p_tia + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c("#AD881D", "#AD881D","#AD881D","#AD881D","#AD881D", "#DEB339", "#AD881D" )) #using 2 tints of the standard yellow
        p_tia <- p_tia + ylab("Twitches in presentation")
        p_tia + xlab("presentation number")
        p_tia <- p_tia + xlab("presentation number")
        p_tia<- p_tia + labs(title="Tungara individuals contrast")
        p_tia<- p_tia + coord_cartesian(ylim = c(0, 25)) #sets y limit
        p_tia <- p_tia + stat_smooth(colour="black", size=0.5, method="lm", se=FALSE ,  data= subset(tia_data, tia_data$set_num!="6" & tia_data$set_num!="7"))
        p_tia
        
        multiplot(p_ra, p_t_ra, p_rra, p_rt, p_de, p_t_de, p_ts, p_tc, p_tia )
      
```


#####Summary stats:

```{r, echo=FALSE}
attn_habit_3<-read.table("https://raw.githubusercontent.com/maydixon/Attn_Project/master/attn_habit_1.txt", sep="\t", header=TRUE)
        View(attn_habit_3)
        str(attn_habit_3) #there is a lot in here I'm not using now
        #glm for all twitches with an interaction between call number and trial name as main effect, bat ID as random effect, for all twitches
        library(nlme)
```

  
   
   
## Discrimination

The following are all the tests for discimination. In each of the following trials, we are comparing the response to the 5th set to the 6th set (the discrimination stimulus), and the 7th set (the dishabituation simulus). A significantly greater response to the 6th or 7th set from the 5th set is indicative of discrimination between the stimuli. In all cases the response was the total number of ear twitches. 
     
To analyze these, I used linear mixed models with the following model: 
     
       *total twitches ~ set number , random = bat*

      (I used trial_number in other models in this analysis, but it did not explain more of the variance in this case)
      
      
      
```{r, include=FALSE}

#import data, remove duds, remove bad treatments
 attention_Rcopy_individuals_condensed <- read.delim("https://raw.githubusercontent.com/maydixon/Attn_Project/master/attention_Rcopy_individuals_condensed.txt", header=TRUE) #this file has all sets, and a row with condensed Tia_tib_Tia

attention_Rcopy1<- subset(attention_Rcopy_individuals_condensed, attention_Rcopy_individuals_condensed$bat_name != "Blackbeard" & attention_Rcopy_individuals_condensed$bat_name != "Wramplemeier") #removes unresponsive bats
attention_Rcopy2<-subset(attention_Rcopy1, attention_Rcopy1$trial_name != "t_rt_t" & attention_Rcopy1$trial_name != "rt_t_rt") #removes variables only tested on one bat
 attn_r2 <- attention_Rcopy2 #short same version
#pull partial string match  x.1 for call number using grep
        
attn_set <- attn_r2[grep(".1", attn_r2$call_num), ]
View(attn_set)
```
 


```{r, include= FALSE }
#2 need to subset data to refer to one treatment at a time
unique(attn_set$trial_name_2)

subset_de <- subset(attn_set, attn_set$trial_name_2=="de_t_de")
subset_ra <- subset(attn_set, attn_set$trial_name_2=="ra_t_ra")
subset_rra <- subset(attn_set, attn_set$trial_name_2=="rra_rt_rra")
subset_rt <- subset(attn_set, attn_set$trial_name_2=="rt_rra_rt")
subset_t_de <- subset(attn_set, attn_set$trial_name_2=="t_de_t")
subset_t_ra <- subset(attn_set, attn_set$trial_name_2=="t_ra_t")
subset_tc <- subset(attn_set, attn_set$trial_name_2=="tc_ts_tc")
subset_tia <- subset(attn_set, attn_set$trial_name_2=="tia_tib_tia")
subset_ts <- subset(attn_set, attn_set$trial_name_2=="ts_tc_ts")

#further subset to only include sets 5, 6, 7
subset_de1 <- subset(subset_de, subset_de$set_num=="5" | subset_de$set_num=="6" | subset_de$set_num=="7" )
subset_ra1 <- subset(subset_ra, subset_ra$set_num=="5" | subset_ra$set_num=="6" | subset_ra$set_num=="7" ) 
subset_rra1 <- subset(subset_rra, subset_rra$set_num=="5" | subset_rra$set_num=="6" | subset_rra$set_num=="7" )
subset_rt1 <- subset(subset_rt, subset_rt$set_num=="5" | subset_rt$set_num=="6" | subset_rt$set_num=="7" )
subset_t_de1 <- subset(subset_t_de, subset_t_de$set_num=="5" | subset_t_de$set_num=="6" | subset_t_de$set_num=="7" )
subset_t_ra1 <- subset(subset_t_ra, subset_t_ra$set_num=="5" | subset_t_ra$set_num=="6" | subset_t_ra$set_num=="7" )
subset_tc1 <- subset(subset_tc, subset_tc$set_num=="5" | subset_tc$set_num=="6" | subset_tc$set_num=="7" )
subset_tia1 <- subset(subset_tia, subset_tia$set_num=="5" | subset_tia$set_num=="6" | subset_tia$set_num=="7" )
subset_ts1 <- subset(subset_ts, subset_ts$set_num=="5" | subset_ts$set_num=="6" | subset_ts$set_num=="7" )

#load library
library(nlme)
#set working directory if running on wherever
#setwd("~/Dropbox/Attention Project/R/Sessions/09.26.16")        
# run one of the lme
# Model should be twitches per set ~ set num * treatment , random= batid #(trial number does not add explanatoryness)
```

### *D. ebracattus* v Tungara: 
normality of data:
```{r, echo= FALSE}
qqnorm(subset_de1$all_tw_set)

```


Results of linear mixed model: This models asks whether there is a significant difference between set 5 & 6, and 5 & 7. 

```{r, echo=FALSE}
de_desc<- lme(all_tw_set ~ as.factor(set_num), random = ~1|Bat_ID, data = subset_de1) # use as.factor so model sees these as factors
```
```{r}
summary(de_desc)
de_t_de_desc <- boxplot(all_tw_set ~ (as.factor(set_num)), main = "de_t_de", data=subset_de1)

```


So, there is no evidence of discrimination between ebracattus and tungara. This may be because there was no habituation to D. ebracattus (actually there was slight sensitization)       


### *Rhinella alata* v Tungara
normality of data: 
```{r}
qqnorm(subset_ra1$all_tw_set)
```
```{r, include=FALSE}
ra_desc<- lme(all_tw_set ~ as.factor(set_num), random = ~1|Bat_ID, data = subset_ra1) # use as.factor so moral sees these as factors
```
```{r}
summary(ra_desc)
#boxplot
ra_descrim_plot<- boxplot(all_tw_set ~ (as.factor(set_num)), main = "ra_t_ra", data=subset_ra1)
```

There is evidence for descrimination between rhinella alata and tungara frogs

### Reversed *R. alata* v tungara

Normality of data:
```{r}
qqnorm(subset_rra1$all_tw_set)
```
```{r, include=FALSE}
rra_desc<- lme(all_tw_set ~ as.factor(set_num), random = ~1|Bat_ID, data = subset_rra1) # use as.factor so morral sees these as factors
```
```{r}
summary(rra_desc)
#boxplot
boxplot(all_tw_set ~ (as.factor(set_num)), main = "rra_rt_rra", data=subset_rra1)
```

There is evidence for descrimination between 5 and 6, but not for dishabituation (5 and 7). There was very steep habituation to reversed rhinella alata, which might explain a part of this trend. 


### reversed tungara v reversed *R. alata*

Normality of data: 
```{r, echo=FALSE}
qqnorm((subset_rt1$all_tw_set))
```

This linear mixed model may not be appropriate for this test given its right-skewed distribution

```{r, echo=FALSE}
rt_desc<- lme(all_tw_set ~ as.factor(set_num), random = ~1|Bat_ID, data = subset_rt1) # use as.factor so mortl sees these as factors
```
``````{r}
summary(rt_desc)
#boxplot
boxplot(all_tw_set ~ (as.factor(set_num)), main = "rt_rra_rt", data=subset_rt1)
```

Is it okay to transform a subset of data and not all of it? If so, I can maybe log or sqrt some of these contrasts that are more skewed so that this test is appropriate.For example:

##Log +1 transformed reversed tungara v reversed rhinella alata

```{r, echo=FALSE}
qqnorm(log(subset_rt1$all_tw_set+1))

rt_desc<- lme((log(all_tw_set+1)) ~ as.factor(set_num), random = ~1|Bat_ID, data = subset_rt1) # use as.factor so mortl sees these as factors
summary(rt_desc)
#boxplot
rt_desc_transformed<-boxplot((log(all_tw_set+1)) ~ (as.factor(set_num)), main = "rt_rra_rt log transformed", data=subset_rt1)
```

Regardless, in this case there is no evidence of descrimination between reversed tungara and reversed alata, due mainly to low overall values. 


### Tungara v *D. ebracattus*

```{r, echo=FALSE}
qqnorm(subset_t_de1$all_tw_set)
#  Should be twitches/set ~set num*treatment t_dendom= batid #trial number does not add explanatoryness
t_de_t_desc<- lme(all_tw_set ~ as.factor(set_num), random = ~1|Bat_ID, data = subset_t_de1) # use as.factor so mot_del sees these as factors
summary(t_de_t_desc)
#boxplot
t_de_t_desc_plot<- boxplot(all_tw_set ~ (as.factor(set_num)), main = "t_de_t", data=subset_t_de1)
```

There is no evidence for descrimination between tungara and dendrobates Perhaps due to high overall responses

###Tungara v R. alata
```{r, echo=FALSE}

#remember to reset relevel if running this again
qqnorm(subset_t_ra1$all_tw_set) 
hist(subset_t_ra1$all_tw_set)
#maybe can't justify normal dist
t_ra_t_desc<- lme(all_tw_set ~ as.factor(set_num), random = ~1|Bat_ID, data = subset_t_ra1) # use as.factor so  sees these as factors
summary(t_ra_t_desc)
#boxplot
t_ra_t_desc_plot<-boxplot(all_tw_set ~ (as.factor(set_num)), main = "t_ra_t", data=subset_t_ra1)
```
No discimination between treatments detected. If it is appropriate to transform these, then: 

# Square-root transformed tungara v R. alata
```{r, echo=FALSE}



qqnorm((sqrt(subset_t_ra1$all_tw_set)))
hist((sqrt(subset_t_ra1$all_tw_set)))

t_ra_t_desc_sqrt_trns<- lme((sqrt(all_tw_set)) ~ as.factor(set_num), random = ~1|Bat_ID, data = subset_t_ra1) # use as.factor so  sees these as factors
summary(t_ra_t_desc_sqrt_trns)
#boxplot
t_ra_t_desc_plot<-boxplot((sqrt(all_tw_set)) ~ (as.factor(set_num)), main = "t_ra_t sq.rt transformed", data=subset_t_ra1)
#this way there is a significant difference at alpha.01 for 5 and 6, but it goes in the negative direction. no significant between 5 and 7. If I relevel, is there a difference between 6 and 7?
```
So there is a significant difference between 5 and 7 (demonstrating dishabituation). To test to see whether there is a significant sifference between 6 and 7, I can relevel, and test this using a linear mixed model. 
```{r, echo=FALSE}



subset_t_ra1$set_num <- relevel(as.factor(subset_t_ra1$set_num), ref="6")
t_ra_t_desc_2<- lme((sqrt(all_tw_set)) ~ as.factor(set_num), random = ~1|Bat_ID, data = subset_t_ra1) # releveled lme
summary(t_ra_t_desc_2)
```


So, there is a marginally significant difference between 6 and 7 (p=0.0945), and 6 and 5 (p=0.0988). But not sure what my alpha level should be. 

# Intraspecific Trials

## Complex tungara v simple tungara
```{r}

qqnorm(subset_tc1$all_tw_set)
#one total outlier (what should I do about that?)
tc_desc<- lme(all_tw_set ~ as.factor(set_num), random = ~1|Bat_ID, data = subset_tc1) # use as.factor so  sees these as factors
summary(tc_desc)
# boxplot
tc_ts_tc_plot<- boxplot(all_tw_set ~ (as.factor(set_num)), main = "tc_ts_tc", data=subset_tc1)
```


There is no apparent discrimination between complex and simple calls in this test. However, there is an outlier that could easily be messing with this. I'm going to think about this a little.  

If this is accurate, it is probable that discrimination is obscured by simple calls being less salient stimuli, so the interuption in habituation is masked by lower overall interest in the simple call. See the inverse treatment:

##Simple tungara against complex tungara call
```{r}

qqnorm(subset_ts1$all_tw_set)
hist(subset_ts1$all_tw_set)
#looks oookay (pretty 0 weighted)
ts_desc<- lme(all_tw_set ~ as.factor(set_num), random = ~1|Bat_ID, data = subset_ts1) # use as.factor so  sees these as factors
summary(ts_desc)
# boxplot
ts_tc_ts_plot<- boxplot(all_tw_set ~ (as.factor(set_num)), main = "ts_tc_ts", data=subset_ts1)    

```

There is support for discrimination between these two treatments, but no evidence of dishabituation. Note how discrimination is evidence when the less salient stimulus is the one that is being habituated. 

## Tungara "A" v Tungara "B" (or the id of individuals trials)

```{r}

qqnorm(subset_tia1$all_tw_set)
# not justifiably normal (left/0 skewed)
tia_desc<- lme(all_tw_set ~ as.factor(set_num), random = ~1|Bat_ID, data = subset_tia1) # use as.factor so  sees these as factors
summary(tia_desc)
# boxplot
tia_tib_tia_plot<- boxplot(all_tw_set ~ (as.factor(set_num)), main = "tia_tib_tia", data=subset_tia1)
```

There is no apparent discrimination between individual tungaras. But also the data are pretty non-normal, so:


##Square-root transformation of individual tungara trials
```{r}

hist(sqrt(subset_tia1$all_tw_set))

# not justifiably normal (left/0 skewed)
tia_desc_sqrt_trans<- lme((sqrt(all_tw_set)) ~ as.factor(set_num), random = ~1|Bat_ID, data = subset_tia1) # use as.factor so  sees these as factors
summary(tia_desc_sqrt_trans)
# boxplot
tia_tib_tia_plot_sqrt<- boxplot((sqrt(all_tw_set)) ~ (as.factor(set_num)), main = "tia_tib_tia sqrt transformed", data=subset_tia1)
```

There is still no evidence of discrimination between individuals

```{r}

```

---




