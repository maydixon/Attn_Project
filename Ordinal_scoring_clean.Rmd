---
title: "Ordinal_scoring_clean"
author: "may"
date: "December 8, 2017"
output: html_document
---

`
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(plyr)
library(dplyr)
library(ggplot2)
library(ggmosaic)
library(ordinal)
library(lme4)
library(lsmeans)
library(readxl)
```

###palette controls for plotting colors, controls all plots
```{r}
#Checking out a palette of colors:
        #plotCol(gray(1.1:11 /11))
     
      
#finding the name of those colors:
      #gray(1.1:8 /9)
      
#reference colors for plots
#can change all from here
Ts  = "#1F1F1F"
T1c ="#3C3C3C"
T2c = "#585858"
De  = "#747474"
Ra  ="#919191"
Rra ="#ADADAD"  
Rt  ="#C9C9C9"

Palette<- "YlGn"  # or "Grays" for grayscale version


```
import data
```{r}
attn_R <- read_excel("~/Dropbox/Attention Solomon Coding/attn_Rcopy_12.7.17_justset.xlsx")
```
remove unresponsive bat
```{r}
attn_R <- subset(attn_R , attn_R $bat_name != "Blackbeard" ) #removes unresponsive bat
```
remove unused treatment
```{r}
attn_R <- subset(attn_R , attn_R $trial_name_2 != "t_rt_t" ) #removes treatment
attn_R <- subset(attn_R , attn_R $trial_name_2 != "rt_t_rt" ) #removes treatment
```

reorder columns
```{r}
attn_R = attn_R %>% select(Bat_ID:set_num, Landing_set, Approach_set, Orienting_set, all_tw_set, mdlg_tw_set, lg_tw_set, md_tw__set, sm_tw_set, Flying_set, Grooming_set, Yawning_set)
head(attn_R)
```
```{r}
t.d.<-attn_R
```


recode data to make ordinal:
```{r}
t.d.$Ordinal3<-rep(0,nrow(t.d.))

for (i in 1:nrow(t.d.)){
      
  if (t.d.$Landing_set[i]>0) {
   t.d.$Ordinal3[i]<-"4"
} else if (t.d.$Approach_set[i]>0) {
      t.d.$Ordinal3[i]<-"3"
} else if (t.d.$mdlg_tw_set[i]>0) {
      t.d.$Ordinal3[i]<-"2"
} else if (t.d.$sm_tw_set[i]>0) {
      t.d.$Ordinal3[i]<-"1"
} else 
      t.d.$Ordinal3[i]<-"0"

}


   # GUIDE #   
# reorder rows in reverse order of ordinal scale
# if land !=0 write "4" in new column, else go to next column
# if approach !=0 write "3" in new column, else go to next column
# if md or lg twitches !=0 write "2" in new column else go to next column
# if smtwitch!=0 write "1" in new column, else write "0"


```


make ordinal data read as ordered factor
```{r}
t.d.$Ordinal3<-factor(t.d.$Ordinal3, ordered = TRUE)
```
make first treatment factors
```{r}
#make primary stim a factor
t.d.$primary_stim<- factor(t.d.$primary_stim, ordered = FALSE)
levels(t.d.$primary_stim)
```

##Now investigate initial interest and all the rest with cumulative linear mixed model. 

####[data wrangling]
```{r}
t.d.int.temp<-subset(t.d., t.d.$set_num=="1") # pull just the first sets

#Now, only include the scores from the first time that bats heard a habituating stimulus

#############GUIDE##########
#subset all rows where primary stim isn't tia or ts
#subset ts
#subset tia
#order by bat id, trial number
#remove duplicates of primary stimulus. should keep the first observation
#combine subsets
#subset all rows where primary stim isn't tia or ts
#############################

t.d.int.most<-subset(t.d.int.temp, t.d.int.temp$primary_stim!="ts" & t.d.int.temp$primary_stim!="t1c") #all except ts, t1c

#ts
t.d.int.ts<-subset(t.d.int.temp, t.d.int.temp$primary_stim=="ts") #subset ts
t.d.int.ts.1<- with(t.d.int.ts, t.d.int.ts[order(t.d.int.ts$Bat_ID, t.d.int.ts$trial_number),])  #order by bat id, trial number
t.d.int.ts.2<- t.d.int.ts.1[!duplicated(t.d.int.ts.1$Bat_ID), ] #removes duplicates, keeps first row, lowest trial#


t.d.int.t1c<-subset(t.d.int.temp, t.d.int.temp$primary_stim=="t1c") #subset tia 
t.d.int.t1c.1<- with(t.d.int.t1c, t.d.int.t1c[order(t.d.int.t1c$Bat_ID, t.d.int.t1c$trial_number),]) #order by bat id, trial number
t.d.int.t1c.2<- t.d.int.t1c.1[!duplicated(t.d.int.t1c.1$Bat_ID), ] #removes duplicates, keeps first (lowest)


t.d.int<-rbind(t.d.int.most, t.d.int.ts.2, t.d.int.t1c.2) #combine subsets, this is the right data to use.

```
#### check initial interest, ordinal scale
```{r}
#current results, ordinal scale

#random only model, clm
#initial interest, intercept only model
int_int_only <- clm(Ordinal3 ~ 1 ,  data = t.d.int, Hess=TRUE)
summary(int_int_only)

# initial interest intercept model, one random effect (the one with most variance), clmm
int_int_rand<-clmm(Ordinal3 ~ 1 + (1|Bat_ID),  data = t.d.int, Hess=TRUE)
summary(int_int_rand)

anova(int_int_only, int_int_rand) 

##not significantly different. So no random effect needed, keep simpler mode, int_rand

## initial interest model with main effect, no random, clm

initial_int_primary<-clm(Ordinal3 ~ primary_stim, data = t.d.int)
summary(initial_int_primary)

# compare intercept only model with stimulus category model
anova(int_int_only, initial_int_primary)


## So, despite that the model with treatment has a potentially significant variable, it is not significantly better than the random model. 

## look at model anyway?

cum_lsmeans_primary<-lsmeans::lsmeans(initial_int_primary, "primary_stim")
cum_lsmeans_primary
sv_cum_lsmeans_primary<- cld(cum_lsmeans_primary)
sv_cum_lsmeans_primary
pairs_lsmeans_primary <-pairs(cum_lsmeans_primary)
pairs_lsmeans_primary
plot(cum_lsmeans_primary)
# adjusted for a fmaily of 7 estimates. 


########
## http://glmm.wdfiles.com/local--files/examples/Banta_2011_part1.pdf
## p. 21
#chosen fixed effects structure, maximalist rand structure:
initial_int_primary_full<-clmm(Ordinal3 ~ primary_stim +  (1|Bat_ID) + (1|trial_number), data = t.d.int)
initial_int_primary_noID<- clmm(Ordinal3 ~ primary_stim +   (1|trial_number), data = t.d.int)
initial_int_primary_notrial<-clmm(Ordinal3 ~ primary_stim +  (1|Bat_ID) , data = t.d.int)
initial_int_primary_nested<-clmm(Ordinal3 ~ primary_stim +  (trial_number|Bat_ID) , data = t.d.int)
initial_int_primary_norand<-clm(Ordinal3 ~ primary_stim , data = t.d.int)

#compare:
anova(initial_int_primary_full, initial_int_primary_notrial ) #no trial
#no difference
anova(initial_int_primary_full, initial_int_primary_noID ) # no bat_ID
# no difference
anova(initial_int_primary_full, initial_int_primary_nested)
#almost significant, nested better
anova(initial_int_primary_nested, initial_int_primary_norand)
anova(initial_int_primary_full, initial_int_primary_nested, initial_int_primary_notrial, initial_int_primary_noID, initial_int_primary_norand)
anova(initial_int_primary_noID, initial_int_primary_norand)
anova(initial_int_primary_notrial, initial_int_primary_norand)
########
```
So it looks like T2c has a marginally higher initial response than to ra or t1c, at least using this model. 

plotting initial interest:
```{r}
levels(t.d.int$primary_stim)
```
```{r}
#reordering for plotting:
      t.d.int$primary_stim <- factor(t.d.int$primary_stim,levels = c("ts" ,"t1c", "t2c" , "de", "ra" , "rra","rt" ),ordered = TRUE)
      
#perhaps best order is: Ts, T, Tc, Rt, Rra, Ra, De, can do using relevel() 
```

WITH TWITCHES
```{r}

int.plot<- ggplot(data = t.d.int, aes(x = primary_stim, y = all_tw_set, fill=primary_stim))
int.plot<- int.plot+ geom_boxplot()
int.plot<- int.plot+ geom_point(position = position_jitter(width = 0.1))
int.plot<- int.plot+ theme(axis.text.x = element_text(angle = 45, hjust=1, size = 14), legend.position = "none") #format x-axis, and remove side legend #hjust 1 aligns labels
int.plot<- int.plot+ scale_x_discrete(labels=c("0c P. pustulosus","1c P. pustulosus","2c pustulosus","D. ebraccatus", "R. alata", "rev R. alata", "rev P. pustulosus"))  +
              scale_fill_manual(breaks = c("0c P. pustulosus","1c P. pustulosus","2c pustulosus","D. ebraccatus", "R. alata", "rev R. alata", "rev P. pustulosus"),
                                values=c(Ts, T1c, T2c, De, Ra, Rra, Rt))
int.plot<- int.plot+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.title= element_text(size=14))  #gets rid of background
int.plot<- int.plot+ xlab("Acoustic stimuli")
int.plot<- int.plot+ ylab("Ear-twitches in trial 1")
int.plot

ggsave("initial_interest_plot.pdf", width = 6.5, height = 5.55)
```
WITH ORDINAL
```{r}
t.d.int$Ordinal3<-as.numeric(t.d.int$Ordinal3)

```

Boxplot:
```{r}
 

int.plot_Ordinal<- ggplot(data = t.d.int, aes(x = primary_stim, y = Ordinal3, fill=primary_stim))
int.plot_Ordinal<- int.plot_Ordinal+ geom_boxplot()
int.plot_Ordinal<- int.plot_Ordinal+ geom_point(position = position_jitter(width = 0.1))
int.plot_Ordinal<- int.plot_Ordinal+ theme(axis.text.x = element_text(angle = 45, hjust=1, size = 14), legend.position = "none") #format x-axis, and remove side legend #hjust 1 aligns labels
int.plot_Ordinal<- int.plot_Ordinal+ scale_x_discrete(labels=c("0c P. pustulosus","1c P. pustulosus","2c pustulosus","D. ebraccatus", "R. alata", "rev R. alata", "rev P. pustulosus"))  +
              scale_fill_manual(breaks = c("0c P. pustulosus","1c P. pustulosus","2c pustulosus","D. ebraccatus", "R. alata", "rev R. alata", "rev P. pustulosus"),
                                values=c(Ts, T1c, T2c, De, Ra, Rra, Rt))
int.plot_Ordinal<- int.plot_Ordinal + coord_cartesian(ylim = c(0, 5))
int.plot_Ordinal<- int.plot_Ordinal+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.title= element_text(size=14))  #gets rid of background
int.plot_Ordinal<- int.plot_Ordinal+ xlab("Acoustic stimuli")
int.plot_Ordinal<- int.plot_Ordinal+ ylab("Ordinal responses in first trial")
int.plot_Ordinal

ggsave("initial_interest_Ordinal.jpg", width = 6.5, height = 5.55)
```

Mosaic plot:
```{r}
 #I'm reversing the ordering of the Ordinal factor, just for plotting, because I think it looks clearer/ more like habituation if the lowest interest score is on the top. 

#doing palette manually so this plot will match the others
#green palette: "#31a354","#78c679", "#c2e699"
#c("#006837", "#31a354", "#78c679","#c2e699", "#ffffcc")
#Gray palette: "#cccccc" , "#969696", "#636363"


##$$$$$$$$$$$$$
## start here, see if this makes the plot better, then look back adn make sure this plot is using the right data, bc different than before 
#$$$$$$$$$$$$$$$$

Int_palette<- c("#006837", "#31a354", "#78c679", "#ffffcc")
#scale color brewer, name colors, ylgn 5

t.d.int.plot<- t.d.int

t.d.int.plot$primary_stim <- factor(t.d.int.plot$primary_stim,levels = c("ts" ,"t1c", "t2c" , "de", "ra" , "rra","rt" ),ordered = TRUE)

t.d.int.plot$Ordinal3<- factor(t.d.int.plot$Ordinal3, levels = c(4, 3, 2, 1, 0))
t.d.int.plot$Ordinal3<- factor(t.d.int.plot$Ordinal3, ordered= FALSE)
levels(t.d.int.plot$Ordinal3)
class(t.d.int.plot$primary_stim)   ##R
 #Ra_T
  mosaic_int<- ggplot(data = t.d.int.plot) +
   geom_mosaic(aes(weight = 1, x = product(Ordinal3, primary_stim), fill=Ordinal3), na.rm=TRUE) +  
        scale_fill_manual(values=Int_palette)+
   #scale_fill_brewer(type="seq", palette= Int_palette, direction=-1) +
  # scale_x_continuous(breaks=c("ts",  "t1c", "t2c", "de",  "ra",  "rra", "rt" ),
     #   labels=c("0c P. pustulosus","1c P. pustulosus","2c pustulosus","D. ebraccatus", "R. alata", "rev R. alata", "rev P. pustulosus"))+
  
          theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #this gets rid of grey background and lines, adds y+x axes lines
        labs(x="Acoustic stimuli ", y= "Interest score in trial 1") +
        guides(fill=guide_legend(title = "Interest Score", reverse = TRUE)) 
  mosaic_int

  
ggsave("initial_interest_mosaic.pdf", width = 6.5, height = 5.55)
```



Ordinal plot 2
(Another way of representing this)
```{r}
t.d.int.summary.data  <- ddply(t.d.int, "primary_stim", summarise, mean=mean(as.numeric(Ordinal3)), sd=sd(as.numeric(Ordinal3)))

t.d.int.summary.data 
```
```{r}
int.plot_Ordinal2<- ggplot(data = t.d.int.summary.data, aes(x = primary_stim, y = mean, fill=primary_stim))
int.plot_Ordinal2<- int.plot_Ordinal2+ geom_point()
int.plot_Ordinal2<- int.plot_Ordinal2+ geom_errorbar(aes(ymin=mean-sd, ymax=mean+sd), width=.2, position=position_dodge(.9)) 
int.plot_Ordinal2<- int.plot_Ordinal2+ theme(axis.text.x = element_text(angle = 45, hjust=1, size = 14), legend.position = "none") #format x-axis, and remove side legend #hjust 1 aligns labels
int.plot_Ordinal2<- int.plot_Ordinal2+ scale_x_discrete(labels=c("0c P. pustulosus","1c P. pustulosus","2c pustulosus","D. ebraccatus", "R. alata", "rev R. alata", "rev P. pustulosus"))  +
              scale_fill_manual(breaks = c("0c P. pustulosus","1c P. pustulosus","2c pustulosus","D. ebraccatus", "R. alata", "rev R. alata", "rev P. pustulosus"),
                                values=c(Ts, T1c, T2c, De, Ra, Rra, Rt))
int.plot_Ordinal2<- int.plot_Ordinal2 + coord_cartesian(ylim = c(0, 5))
int.plot_Ordinal2<- int.plot_Ordinal2+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.title= element_text(size=14))  #gets rid of background
int.plot_Ordinal2<- int.plot_Ordinal2+ xlab("Acoustic stimuli")
int.plot_Ordinal2<- int.plot_Ordinal2+ ylab("Ordinal Response")
int.plot_Ordinal2


```
#######################




##Habituation

####Data wrangling

Just look at trials/sets 1-5 (remove 6 & 7)
```{r}

t.d.hab. <- subset(t.d., t.d.$set_num!="6" & t.d.$set_num!="7")

```


```{r}
## this can only run this with Laplace approximations, not quadrature methods, if I want more than one random effect. 
## see whether I need 2 random effects. run withjust one, then add the other random effect, compare

#no random effect: 
habit.ordinal3.mod.nr<- clm(Ordinal3 ~ set_num:primary_stim, data= t.d.hab.)

#one random effect
habit.ordinal3.mod2 <- clmm(Ordinal3 ~ set_num:primary_stim + (1| Bat_ID), data= t.d.hab., Hess=TRUE)


#two random effects
habit.ordinal3.mod3 <- clmm(Ordinal3 ~ set_num:primary_stim + (1| Bat_ID) + (1 | trial_number), data= t.d.hab., Hess=TRUE)


#two random effects, nested
habit.ordinal3.mod4 <- clmm(Ordinal3 ~ set_num:primary_stim + (trial_number| Bat_ID), data= t.d.hab., Hess=TRUE)

sumO3.mnr<- summary(habit.ordinal3.mod.nr)
sumO3.m2<- summary(habit.ordinal3.mod2)
sumO3.m3<- summary(habit.ordinal3.mod3)
sumO3.m4<- summary(habit.ordinal3.mod4)
#compare models

anovarandom<- anova(habit.ordinal3.mod.nr, habit.ordinal3.mod2)
anovarandom
anovarandom1 <- anova(habit.ordinal3.mod2, habit.ordinal3.mod3)
anovarandom1
anovarandom2 <- anova(habit.ordinal3.mod3, habit.ordinal3.mod4) 
anovarandom2


## so, it seems as though trial_number is an important random effect
## runs better with it nested within bat_ID (different bats respond differently to trial number)
##the model with nested random effects and both random effects is the best
```

Compare main effects to find best model
```{r}

### Do I have to make an intercept free model to compare my estimates, to make them the true predictions while taking into account covariace between the estimates? I think no, because I'm am calculating the predictions with lsmeans, which does this in their calculations. 
### anyway, running with clmm without an intercept seems impossible, it just ignores that part and puts it back in. 

### compare lsmeans output with just interaction and with main effects
   

habit.ordinal3.null<- clmm(Ordinal3 ~ 1 + (trial_number| Bat_ID), data= t.d.hab., Hess=TRUE) ##null

habit.ordinal3.intonly<- clmm(Ordinal3 ~ set_num:primary_stim + (trial_number| Bat_ID), data= t.d.hab., Hess=TRUE) ## this one is the best

habit.ordinal3.primary.int<- clmm(Ordinal3 ~ primary_stim + set_num:primary_stim + (trial_number| Bat_ID), data= t.d.hab., Hess=TRUE)


habit.ordinal3.primary<- clmm(Ordinal3 ~ primary_stim + (trial_number| Bat_ID), data= t.d.hab., Hess=TRUE) 

habit.ordinal3.set<- clmm(Ordinal3 ~ set_num + (trial_number| Bat_ID), data= t.d.hab., Hess=TRUE) 

habit.ordinal3.set.primary<- clmm(Ordinal3 ~ set_num + primary_stim + (trial_number| Bat_ID), data= t.d.hab., Hess=TRUE) 

habit.ordinal3.set.primary.int <- clmm(Ordinal3 ~ set_num*primary_stim + (trial_number| Bat_ID), data= t.d.hab., Hess=TRUE)

#iterative model selection. add variables and delete them if they do not improve model. 
# do I have to start with main effects, or can i start with apriori hypotheses on what is important?
anova1<- anova(habit.ordinal3.null, habit.ordinal3.set)
anova1
anova2<- anova(habit.ordinal3.set, habit.ordinal3.set.primary)
anova2
anova3<- anova(habit.ordinal3.set.primary, habit.ordinal3.set.primary.int)
anova3
###I just have to look at the interaction alone...
#~~~~~~~~~~~~~~~~~~~
anova.me<- anova(habit.ordinal3.null, habit.ordinal3.intonly)
anova.me
anova.me1<-anova(habit.ordinal3.intonly, habit.ordinal3.modfull)
anova.me1 #interaction only model is best
anova.me2<-anova(habit.ordinal3.intonly, habit.ordinal3.me2)
anova.me2
anova.me3<-anova(habit.ordinal3.intonly, habit.ordinal3.me3)
anova.me3
anova.me4<- anova(habit.ordinal3.intonly, habit.ordinal3.me4)
anova.me4
anova.me5<- anova(habit.ordinal3.me5, habit.ordinal3.modfull)
anova.me5
anova.all<- anova(habit.ordinal3.null, habit.ordinal3.intonly, habit.ordinal3.me2, habit.ordinal3.me3, habit.ordinal3.me4, habit.ordinal3.modfull)


anova.all
    #interaction only model is slightly better than any of the others
```
Model estimates for model with interaction, two random effects
```{r}

sum.habit.ordinal3.intonly<- summary(habit.ordinal3.intonly)
sum.habit.ordinal3.intonly
```

lmeans, differences between treatments
```{r}

#calculate lsmeans over the set number
lst.ord3.intonly=lsmeans::lstrends(habit.ordinal3.intonly, ~primary_stim, var="set_num")

# Show which are different from one another in letter form:
svlst.ord3.intonly<-cld(lst.ord3.intonly)
svlst.ord3.intonly

#show pairwise contrasts:
p.lst.ord3.intonly<- pairs(lst.ord3.intonly)
p.lst.ord3.intonly
#plot distributions
plot(svlst.ord3.intonly)
```

So, actually pretty consistent results between analysis strategies. 

***
Add in twitches results for this section to compare directly better
***

### Plot of just lstrends output, ordinal scale

```{r}
#######################
#can change all colors from here
Ts  = "#1F1F1F"
T1c ="#3C3C3C"
T2c = "#585858"
De  = "#747474"
Ra  ="#919191"
Rra ="#ADADAD"  
Rt  ="#C9C9C9"
########################

svlst.om<-svlst.ord3.intonly #ordering factor to change position of plots

svlst.om$primary_stim<-factor(svlst.om$primary_stim, levels = c("ts" ,"t1c", "t2c" , "de", "ra" , "rra","rt"), ordered=TRUE)

  theme_set(theme_classic())    

confint_comp_ls_om<- ggplot(svlst.om, aes(primary_stim,ymin=asymp.LCL,ymax=asymp.UCL,colour=primary_stim))+
    geom_linerange() +
 theme(panel.grid.major = element_blank(), panel.grid.minor =  element_blank(),panel.background = element_blank(),  axis.line = element_line(colour = "black"),
legend.position = "none", axis.text.x = element_text(angle = 45, hjust=1))  + #gets rid of background
scale_x_discrete(labels=c("0c P. pustulosus","1c P. pustulosus","2c pustulosus","D. ebraccatus", "R. alata", "rev R. alata", "rev P. pustulosus"))  +
              scale_colour_manual(breaks = c("0c P. pustulosus","1c P. pustulosus","2c pustulosus","D. ebraccatus", "R. alata", "rev R. alata", "rev P. pustulosus"),
                                values=c(Ts, T1c, T2c, De, Ra, Rra, Rt)) +
#scale_fill_manual(breaks = c("ts","t1c","t2c","de", "ra", "rra", "rts"),
                             #   values=c(Ts, T1c, T2c, de, ra, rra, rt)) +

 xlab("Call Type") +
ylab("Slope of interest score in habituation period") +
      geom_hline(yintercept=0, linetype="dotted") 
      

confint_comp_ls_om
ggsave("habituation_slope_plot_grayscale_ordinal.png",width=3, height =4)
```
 
##### Exploratory visualization between the two analysis types. 
```{r}
### compare estimates for the two analysis types
comp_meth <- ggplot(data= t.d., aes(x=Ordinal3, y=all_tw_set, color=primary_stim))
comp_meth <- comp_meth + geom_point(position = position_jitter( width = 0.3))
comp_meth <- comp_meth + geom_smooth(method='lm')
comp_meth

ggsave("comparison_twitches_and_ordinal_scales.png")
## ... its a bell curve
## Very few bats reaching highest levels of ordinal scale
```
a bell curve, mostly b/c there aren't a lot of points for the highest categories! And bc bats can't twitch when they are flying. Relationship between number and size of twitch makes sense

What are the overall ordinal scores in each treatment
```{r}

## ordinal scale per treatment?
comp_treat <- ggplot(data= t.d., aes(x = primary_stim, y = Ordinal3, color=primary_stim))
comp_treat <- comp_treat + theme( legend.position = "none", axis.text.x = element_text(angle = 45, hjust=1))   #gets rid of background
comp_treat <- comp_treat + scale_x_discrete(labels=c("D. ebraccatus", "R. alata", "rev R. alata", "rev P. pustulosus","1c P. pustulosus","2c pustulosus", "0c P. pustulosus"))
comp_treat <- comp_treat + geom_point(position = position_jitter(height=0.25, width=0.25))
comp_treat

ggsave("Total responses per treatment.png")
## a few different treatments with approach and land scores
```



########################

### Discrimination

[data wrangling]

```{r, include = FALSE}
## start with t.d.
## Seperate "trial type"and the last 3 trial/sets
## This is coded terribly, but it works, ok

subset_O_de <- subset(t.d., t.d.$trial_name_2=="de_t_de" & (t.d.$set_num=="5" |t.d.$set_num=="6" |t.d.$set_num=="7"))
subset_O_ra <- subset(t.d., t.d.$trial_name_2=="ra_t_ra" & (t.d.$set_num=="5" |t.d.$set_num=="6" |t.d.$set_num=="7"))
subset_O_rra <- subset(t.d., t.d.$trial_name_2=="rra_rt_rra" & (t.d.$set_num=="5" |t.d.$set_num=="6" |t.d.$set_num=="7"))
subset_O_rt <- subset(t.d., t.d.$trial_name_2=="rt_rra_rt" & (t.d.$set_num=="5" |t.d.$set_num=="6" |t.d.$set_num=="7"))
subset_O_t_de <- subset(t.d., t.d.$trial_name_2=="t_de_t" & (t.d.$set_num=="5" |t.d.$set_num=="6" |t.d.$set_num=="7"))
subset_O_t_ra <- subset(t.d., t.d.$trial_name_2=="t_ra_t" & (t.d.$set_num=="5" |t.d.$set_num=="6" |t.d.$set_num=="7"))
subset_O_tc <- subset(t.d., t.d.$trial_name_2=="tc_ts_tc" & (t.d.$set_num=="5" |t.d.$set_num=="6" |t.d.$set_num=="7"))
subset_O_tia <- subset(t.d., t.d.$trial_name_2=="tia_tib_tia" & (t.d.$set_num=="5" |t.d.$set_num=="6" |t.d.$set_num=="7"))

subset_O_ts <- subset(t.d., t.d.$trial_name_2=="ts_tc_ts" & (t.d.$set_num=="5" |t.d.$set_num=="6" |t.d.$set_num=="7"))





###FRIEDMAN TEST#####
library(reshape2)
t_de_cast <- dcast(subset_O_t_de, bat_name~set_num ) #reshapes into wide format
de_cast <- dcast(subset_O_de, bat_name~set_num )
ra_cast <- dcast(subset_O_ra, bat_name~set_num )
rra_cast <- dcast(subset_O_rra, bat_name~set_num )
t_ra_cast <- dcast(subset_O_t_ra, bat_name~set_num )
rt_cast <- dcast(subset_O_rt, bat_name~set_num )
tc_cast <- dcast(subset_O_tc, bat_name~set_num )
ts_cast <- dcast(subset_O_ts, bat_name~set_num )
#tia_cast <- dcast(subset_O_tia, bat_name ~ set_num)
#can't do tia for now


f.test_de <- friedman.test(cbind(de_cast$"5", de_cast$"6", de_cast$"7"))
f.test_t_de <- friedman.test(cbind(t_de_cast$"5", t_de_cast$"6", t_de_cast$"7"))
f.test_ra <- friedman.test(cbind(ra_cast$"5", ra_cast$"6", ra_cast$"7"))
f.test_rra <- friedman.test(cbind(rra_cast$"5", rra_cast$"6", rra_cast$"7"))
f.test_t_ra <- friedman.test(cbind(t_ra_cast$"5", t_ra_cast$"6", t_ra_cast$"7"))
f.test_rt <- friedman.test(cbind(rt_cast$"5", rt_cast$"6", rt_cast$"7"))
f.test_tc <- friedman.test(cbind(tc_cast$"5", tc_cast$"6", tc_cast$"7"))
f.test_ts <- friedman.test(cbind(ts_cast$"5", ts_cast$"6", ts_cast$"7"))
#f.test_tia <- friedman.test(cbind(tia_cast$"5", tia_cast$"6", tia_cast$"7"))
f.test_de
f.test_t_de
f.test_ra
f.test_rra
f.test_t_ra
f.test_rt
f.test_tc
f.test_ts
#f.test_tia

t_de_ordinal_slim<- cbind(subset_O_t_de$bat_name, subset_O_t_de$set_num, subset_O_t_de$Ordinal3)
t_de_ordinal_slim <- as.data.frame(t_de_ordinal_slim, row.names = c("ID", "Set", "Val"))
t_de_m <- reshape(t_de_ordinal_slim, idvar = "V1", timevar = "V2", direction = "wide")


friedman.test(cbind(t_de_m$V3.5, t_de_m$V3.6, t_de_m$V3.7))


posthocs: mann-whitney/ wilcox

#not sure this is right
wilcox_ts<- pairwise.wilcox.test(as.numeric(subset_O_ts$Ordinal3),  subset_O_ts$set_num,  p.adjust.method="holm")


wilcox_rra<- pairwise.wilcox.test(as.numeric(subset_O_rra$Ordinal3),  subset_O_rra$set_num,  p.adjust.method=p.adjust.methods)
wilcox_rra

wilcox_ra<- pairwise.wilcox.test(as.numeric(subset_O_ra$Ordinal3),  subset_O_ra$set_num,  p.adjust.method=p.adjust.methods)


wilcox_ra
wilcox_rra
wilcox_ts

 
```

## Summary chart

***
Fill in with results for ordinal scale
***
| trial_name | descrim? |dishabit? | comments
|:----------|------|------|-------------------------------------------|
|de_t_de  | no | no | probably bc no habituation in first place x|
|t_de_t | no |no | probably bc high overall responses, low habit x|
|ra_t_ra |yes, strong | yes | model failed to converge tho x|
|t_ra_t | no | no | model didn't converge, failed hessian?x |
|rra_rt_rra | yes, strong | no | x |
|rt_rra_rt | yes | no | x |
|tc_ts_tc |no |no |  crazy outlier to deal with, possbily no habituation|
|ts_tc_ts | yes | no | more clear bc better habituation x|
| tia_tib_tia | no | no | not even at all. should have habituated too |


### *D. ebracattus* v Tungara: 


Results of linear mixed model: This models asks whether there is a significant difference between set 5 & 6, and 5 & 7. 
same with clmm

GLMM found there is *no evidence of discrimination* between ebracattus and tungara. This may be because there was no habituation to D. ebracattus (actually there was slight sensitization) 
CLMM found *NO EVIDENCE OF DISCRIMINATION* 
```{r, echo=FALSE}
de_desc_clm <- clmm(Ordinal3 ~ as.factor(set_num) + (1|Bat_ID) , data = subset_O_de, Hess=TRUE)
summary(de_desc_clm)
de_t_de_desc <- boxplot(Ordinal3 ~ (as.factor(set_num)), main = "de_t_de", data=subset_O_de)
de_lst<-lsmeans(de_desc_clm, ~set_num)
cld_de<-cld(de_lst)
cld_de
pair_cld_de<- pairs(de_lst)

```



### *Rhinella alata* v Tungara


There is evidence for discrimination between rhinella alata and tungara frogs using twitches, AND using Ordinal scale (not very sensitive)
No evidence with either scale of dishabituation
```{r, include=FALSE}

ra_desc_clm <- clmm(Ordinal3 ~ as.factor(set_num) + (1|Bat_ID) , data = subset_O_ra, Hess=TRUE)

sumra<- summary(ra_desc_clm)
sumra
#boxplot
ra_descrim_plot<- boxplot(Ordinal3 ~ (as.factor(set_num)), main = "ra_t_ra", data=subset_O_ra)
ra_descrim_plot

ra_lst<-lsmeans(ra_desc_clm, ~set_num)
cld_ra<-cld(ra_lst)
cld_ra
pairs_cld_ra<- pairs(ra_lst)
```

### Reversed *R. alata* v tungara

There is evidence for descrimination between 5 and 6, but not for dishabituation (5 and 7) with both scales. There was very steep habituation to reversed rhinella alata, which might explain a part of this trend. 

So,  they discriminate / can discriminate to the sounds of the reversed rhinella and the reversed tungara. 


```{r, include=FALSE}

rra_desc_clm <- clmm(Ordinal3 ~ as.factor(set_num) + (1|Bat_ID) , data = subset_O_rra)

summary(rra_desc_clm)
#boxplot
boxplot(Ordinal3 ~ (as.factor(set_num)), main = "rra_rt_rra", data=subset_O_rra)

rra_lst<-lsmeans(rra_desc_clm, ~set_num)
cld_rra<-cld(rra_lst)
cld_rra
pairs_cld_rra<- pairs(rra_lst)

```


### reversed tungara v reversed *R. alata*
### return to these values, 6 is way low. 
model didn't converge, probably bc near boundary. The different treatments do not appear to be different (using lsmeans) (though it did converge with Original Ordinal scale)
```{r, echo=FALSE}
subset_O_rt$set_num<- as.factor(subset_O_rt$set_num)

rt_desc_clm <- clm(Ordinal3 ~ as.factor(set_num)  , data = subset_O_rt, Hess=TRUE)
summary(rt_desc_clm)
rt_desc_clmx <- clm(Ordinal3 ~ as.factor(set_num) , data = subset_O_rt, Hess=TRUE)
summary(rt_desc_clmx)
#boxplot
plot(Ordinal3 ~ (as.factor(set_num)), main = "rt_rra_rt", data=subset_O_rt)

rt_lst<-lsmeans(rt_desc_clm, ~set_num) 
cld_rt<-cld(rt_lst)
cld_rt
pairs_cld_rt<- pairs(rt_lst)
```

 there is discrimination, if not dishabituation between reversed tungara and reversed alata using continuous scores 
 THERE IS NO DIFFERENCE using ordinal scales.  


### Tungara v *D. ebracattus*

```{r, echo=FALSE}

t_de_desc_clm <- clmm(Ordinal3 ~ as.factor(set_num) + (1|Bat_ID) , data = subset_O_t_de, Hess=TRUE)
sum_t_de<- summary(t_de_desc_clm)
sum_t_de
#boxplot
t_de_t_desc_plot<- boxplot(Ordinal3 ~ (as.factor(set_num)), main = "t_de_t", data=subset_O_t_de)
```
dif analysis strategy
```{r}
#data restructure

t_de_ordinal_slim<- cbind(subset_O_t_de$bat_name, subset_O_t_de$set_num, subset_O_t_de$Ordinal3)
t_de_ordinal_slim <- as.data.frame(t_de_ordinal_slim, row.names = c("ID", "Set", "Val"))
t_de_m <- reshape(t_de_ordinal_slim, idvar = "V1", timevar = "V2", direction = "wide")

friedman.test(cbind(t_de_m$V3.5, t_de_m$V3.6, t_de_m$V3.7))
#same outcome
## 
## 	Friedman rank sum test
## 
## data:  cbind(read, write, math) 
## Friedman chi-squared = 0.645, df = 2, p-value = 0.7244
```
```{r}
t_de_lst<-lsmeans(t_de_desc_clm, ~set_num)
cld_t_de<-cld(t_de_lst)
cld_t_de
pairs_cld_t_de<- pairs(t_de_lst)
```

There is no evidence for discrimination between tungara and dendrobates in twitches Perhaps/ likley due to high overall responses
No evidence of discrim or habit using Ordinal scale either

Also no differences using ordinal scale. 
###Tungara v R. alata
```{r, echo=FALSE}
t_ra_t_desc_plot<- boxplot(Ordinal3 ~ (as.factor(set_num)), main = "t_ra_t", data=subset_O_t_ra)

t_ra_desc_clm <- clmm(Ordinal3 ~ as.factor(set_num) + (1|Bat_ID) , data = subset_O_t_ra, Hess=TRUE)
summary(t_ra_desc_clm)


t_ra_lst <- lsmeans(t_ra_desc_clm, ~set_num)
cld_t_ra <- cld(t_ra_lst)
cld_t_ra
pairs_cld_t_ra<- pairs(t_ra_lst)
pairs_cld_t_ra

## regular Kruskal wallance

t_ra_k.test<- kruskal.test(Ordinal3 ~ as.factor(set_num), data =subset_O_t_ra )
t_ra_k.test
```




## Intraspecific Trials

## Complex tungara v simple tungara
```{r}

tc_desc_clm <- clmm(Ordinal3 ~ as.factor(set_num) + (1|Bat_ID) , data = subset_O_tc, Hess=TRUE)
summary(tc_desc_clm)
# boxplot
tc_ts_tc_plot<- boxplot(Ordinal3 ~ (as.factor(set_num)), main = "tc_ts_tc", data=subset_O_tc)

tc_lst<-lsmeans(tc_desc_clm, ~set_num)
cld_tc<-cld(tc_lst)
cld_tc
pairs_cld_tc <- pairs(tc_lst)
```

No evidence of habituation or discrimination with either scale. 
It is probable that discrimination is obscured by simple calls being less salient stimuli, so the interuption in habituation is masked by lower overall interest in the simple call. See the inverse treatment:


##Simple tungara against complex tungara call
```{r}
class(as.factor(subset_O_ts$set_num))

ts_desc_clm <- clmm(Ordinal3 ~ as.factor(set_num) + (1|Bat_ID) , data = subset_O_ts, Hess=TRUE)
summary(ts_desc_clm)
ts_lst<-lsmeans(ts_desc_clm, ~ as.factor(set_num))
cld_ts<-cld(ts_lst)
cld_ts
pairs_cld_ts<- pairs(ts_lst)
pairs_cld_ts
# boxplot
ts_tc_ts_plot<- boxplot(Ordinal3 ~ (as.factor(set_num)), main = "ts_tc_ts", data=subset_O_ts)    

```
diff analysis strat
```{r}
#data restructure

ts_ordinal_slim<- cbind(subset_O_ts$bat_name, subset_O_ts$set_num, subset_O_ts$Ordinal3)
ts_ordinal_slim <- as.data.frame(ts_ordinal_slim, row.names = c("ID", "Set", "Val"))
ts_m <- reshape(ts_ordinal_slim, idvar = "V1", timevar = "V2", direction = "wide")

friedman.test(cbind(ts_m$V3.5, t_de_m$V3.6, t_de_m$V3.7))
#same outcome

```


 WITH ORDINAL SCALE, using lsmeans, MARGINALLY significant (p=0.0565) ((P value adjustment: tukey method for comparing a family of 3 estimates )) 
 
Bats discriminate between complex and simple tungara calls using twitches (0c v 2c). There is clear evidence of discrimination (lack of stimulus genalization), but not of dishabituation  Note how discrimination is more apparent when the less salient stimulus is the one that is being habituated. ((Also, more habituation=more evidence of discrimination))

## Tungara "A" v Tungara "B" (or the id of individuals trials)

```{r}

tia_desc_clm <- clmm(Ordinal3 ~ as.factor(set_num) + (1|Bat_ID) , data = subset_O_tia, Hess=TRUE)
summary(tia_desc_clm)

tia_lst<-lsmeans(tia_desc_clm, ~set_num)
cld_tia<-cld(tia_lst)
cld_tia
pairs_cld_tia<- pairs(tia_lst)

# boxplot
tia_tib_tia_plot<- boxplot(Ordinal3 ~ (as.factor(set_num)), main = "tia_tib_tia", data=subset_O_tia)
```

There is no apparent discrimination between individual tungaras with either scale. 
####significant differences and pairwise contrasts summary:

All together: 
```{r}
cld_de
cld_tia
cld_ra
cld_rra
cld_rt
cld_t_de
cld_t_ra
cld_tc
cld_ts

pair_cld_de

pairs_cld_ra

pairs_cld_rra

pairs_cld_rt

pairs_cld_t_de

pairs_cld_t_ra

pairs_cld_tc
pairs_cld_ts

pairs_cld_tia
```
###Plots of whole trials with Ordinal Scaling by set

t.d. dataset works  
        

#### de_t_de
#make de_data
```{r}
      
       
        #DE
        de_data <- t.d.[t.d.$trial_name_2=="de_t_de", ]  
```

boxplot
```{r}
 #making a plot for the entire of one treatment, with each set getting a boxplot
        
        p_de <-ggplot(data=de_data, aes(x = set_num, y = as.numeric(Ordinal3)) )     
        p_de <- p_de + geom_boxplot(aes(fill=factor(set_num)))
        #p_de<- p_de + geom_point(position = position_jitter(width = 0.1))
        p_de <- p_de + guides(fill=FALSE)
        p_de <- p_de + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c(De, De, De, De, De, Ts, De))
       # p_de <- p_de + ylab(element_blank())
       #p_de <- p_de + xlab(element_blank())
        p_de<- p_de + labs(title = "D. ebraccatus / 0-chuck P. pustulosus") +
                  theme(plot.title = element_text(face="italic", size=31.5)) #this makes the plot title italic, affects the size
         p_de <- p_de + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.y=element_blank(),  axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) #this gets rid of grey background and lines, adds 2 axes
        p_de <- p_de + coord_cartesian(ylim = c(0, 5))
        #p_de <- p_de + stat_smooth(colour="black", size=0.5, method="lm", se=FALSE ,  data= subset(de_data, de_data$set_num!="6" & de_data$set_num!="7")) 
       
        p_de
 #ggsave("de_trial_ordinal.jpg", height =5, width = 7.5)             
```

mosaic 
```{r}
# Attempt at a mosaic plot
str(de_data$Ordinal3)
levels(de_data$Ordinal3)

#I'm reversing the ordering of the Ordinal factor, just for plotting, because I think it looks clearer/ more like habituation if the lowest interest score is on the top. 
de_data$Ordinal3<- factor(de_data$Ordinal3, levels = c(4, 3, 2, 1, 0))
levels(de_data$Ordinal3)

 
mosaic_de<- ggplot(data = de_data) +
geom_mosaic(aes(weight = 1, x = product(Ordinal3, set_num), fill=Ordinal3), na.rm=TRUE) +  
scale_fill_brewer(type="seq", palette= Palette, direction=-1) +
labs(x="Trial number ", title='Interest scores by trial number') + 
labs(title =  " D. ebraccatus / 0-chuck P. pustulosus") +
theme(plot.title = element_text(face="italic", size=31.5)) + #this makes the plot title italic, affects the size
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),  axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) + #this gets rid of grey background and lines, adds y+x axes lines
guides(fill=guide_legend(title = "Interest Score", reverse = TRUE)) 
mosaic_de 
# alternate palette "YlGnBu"


#ggsave("de_trial_mosaic.pdf", height =5, width = 7)  
  
#axis.text.y=element_blank(),

```

#### t_de data
```{r}
      
       
        #T_DE
        t_de_data<- t.d.[t.d.$trial_name_2=="t_de_t", ] 
```

```{r}
        p_t_de<-ggplot(data=t_de_data, aes(x = set_num, y = as.numeric(Ordinal3)))      
      
        p_t_de<- p_t_de+ geom_boxplot(aes(fill=factor(set_num)))
        #p_de<- p_t_de+ geom_point(position = position_jitter(width = 0.1))
        p_t_de<- p_t_de+ guides(fill=FALSE)
        p_t_de<- p_t_de+ scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c(Ts, Ts, Ts, Ts, Ts, De, Ts))
       # p_t_de<- p_t_de+ ylab(element_blank())
       #p_t_de<- p_t_de+ xlab(element_blank())
        p_t_de <- p_t_de+ labs(title =  "0-chuck P. pustulosus / D. ebraccatus") +
                  theme(plot.title = element_text(face="italic", size=29.5)) #this makes the plot title italic, affects the size
         p_t_de <- p_t_de+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.y=element_blank(), axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) #this gets rid of grey background and lines, adds 2 axes
        p_t_de<- p_t_de+ coord_cartesian(ylim = c(0,5))
        #p_t_de<- p_t_de+ stat_smooth(colour="black", size=0.5, method="lm", se=FALSE ,  data= subset(de_data, de_data$set_num!="6" & de_data$set_num!="7")) 
       
        p_t_de
 ggsave("t_de_trial_ordinal.jpg", height =5, width = 7)             
```

mosaic t_de
```{r}
# Attempt at a mosaic plot
str(t_de_data$Ordinal3)
levels(t_de_data$Ordinal3)

#I'm reversing the ordering of the Ordinal factor, just for plotting, because I think it looks clearer/ more like habituation if the lowest interest score is on the top. 
t_de_data$Ordinal3<- factor(t_de_data$Ordinal3, levels = c(4, 3, 2, 1, 0))
levels(t_de_data$Ordinal3)

 #Ra_T
mosaic_t_de<- ggplot(data = t_de_data) +
geom_mosaic(aes(weight = 1, x = product(Ordinal3, set_num), fill=Ordinal3), na.rm=TRUE) +  
scale_fill_brewer(type="seq", palette= Palette, direction=-1) +
labs(x="Trial number ", title='Interest scores by trial number') + 
labs(title =  " 0-chuck P. pustulosus / D. ebraccatus") +
theme(plot.title = element_text(face="italic", size=29.5)) + #this makes the plot title italic, affects the size
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),  axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) + #this gets rid of grey background and lines, adds y+x axes lines
guides(fill=guide_legend(title = "Interest Score", reverse = TRUE)) 
mosaic_t_de 
# alternate palette "YlGnBu"


ggsave("t_de_trial_mosaic.pdf", height =5, width = 7)  
  
#axis.text.y=element_blank(),

```

[ra_t_ra]
```{r}
      
        #making a plot for the entire of one treatment, with each set getting a boxplot
        
        #Ra_T
        ra_t_data <- t.d.[t.d.$trial_name_2=="ra_t_ra", ]       
        p_ra <- ggplot(data=ra_t_data, aes(x = set_num, y = as.numeric(Ordinal3)))      
        p_ra <- p_ra + geom_boxplot(aes(fill=factor(set_num)))
        #p_ra <- p_ra + geom_point(position = position_jitter(width = 0.1))
        p_ra<- p_ra + guides(fill=FALSE)
        p_ra<- p_ra + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c(Ra, Ra, Ra, Ra, Ra, Ts, Ra))
       # p_ra<- p_ra + ylab(element_blank())
       #p_ra <- p_ra + xlab(element_blank())
        p_ra <- p_ra + labs(title =  " R. alata / 0-chuck P. pustulosus") +
             theme(plot.title = element_text(face="italic", size=29.5)) #this makes the plot title italic, affects the size
         p_ra <- p_ra + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.y=element_blank(), axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) #this gets rid of grey background and lines, adds 2 axes
        p_ra <- p_ra + coord_cartesian(ylim = c(0,5))
        
        p_ra
 ggsave("ra_t_trial_ordinal.pdf", height =5, width = 7)             
```

mosaic ra_t_ra
```{r}

##Palette
#ffffcc
#a1dab4
#41b6c4
#2c7fb8
#253494
interest_palette<- c("#ffffcc", "#a1dab4"," #41b6c4", "#2c7fb8", "#253494")

# Attempt at a mosaic plot
str(ra_t_data$Ordinal3)
levels(ra_t_data$Ordinal3)

#I'm reversing the ordering of the Ordinal factor, just for plotting, because I think it looks clearer/ more like habituation if the lowest interest score is on the top. 
ra_t_data$Ordinal3<- factor(ra_t_data$Ordinal3, levels = c(4, 3, 2, 1, 0))
levels(ra_t_data$Ordinal3)

 #Ra_T
mosaic_ra<- ggplot(data = ra_t_data) +
geom_mosaic(aes(weight = 1, x = product(Ordinal3, set_num), fill=Ordinal3), na.rm=TRUE) +  
scale_fill_brewer(type="seq", palette= Palette, direction=-1) +
labs(x="Trial number ", title='Interest scores by trial number') + 
labs(title =  " R. alata / 0-chuck P. pustulosus") +
theme(plot.title = element_text(face="italic", size=29.5)) + #this makes the plot title italic, affects the size
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),  axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) + #this gets rid of grey background and lines, adds y+x axes lines
guides(fill=guide_legend(title = "Interest Score", reverse = TRUE)) 
mosaic_ra 
# alternate palette "YlGnBu"


ggsave("ra_t_trial_mosaic.pdf", height =5, width = 7)  
  
#axis.text.y=element_blank(),

```
#### [t_ra_t]

data
```{r}
      
        #t_ra
        t_ra_data <- t.d.[t.d.$trial_name_2=="t_ra_t", ]  
```

boxplot
```{r}
        p_t_ra <- ggplot(data = t_ra_data, aes(x = set_num, y = as.numeric(Ordinal3)))      
        p_t_ra <- p_t_ra + geom_boxplot(aes(fill=factor(set_num)))
        #p_t_ra <- p_t_ra + geom_point(position = position_jitter(width = 0.1))
        p_t_ra<- p_t_ra + guides(fill=FALSE)
        p_t_ra<- p_t_ra + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c(Ts, Ts, Ts, Ts, Ts, Ra, Ts))
       # p_t_ra<- p_t_ra + ylab(element_blank())
       #p_t_ra <- p_t_ra + xlab(element_blank())
        p_t_ra <- p_t_ra + labs(title =  " 0-chuck P. pustulosus / R. alata") +
             theme(plot.title = element_text(face="italic", size=29.5)) #this makes the plot title italic, affects the size
         p_t_ra <- p_t_ra + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.y=element_blank(), axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) #this gets rid of grey background and lines, adds 2 axes
        p_t_ra <- p_t_ra + coord_cartesian(ylim = c(0,5))
        
        p_t_ra
 ggsave("t_ra_trial_ordinal.jpg", height =5, width = 7)             
```

mosaic t_ra
```{r}
# Attempt at a mosaic plot
str(t_ra_data$Ordinal3)
levels(t_ra_data$Ordinal3)

#I'm reversing the ordering of the Ordinal factor, just for plotting, because I think it looks clearer/ more like habituation if the lowest interest score is on the top. 
t_ra_data$Ordinal3<- factor(t_ra_data$Ordinal3, levels = c(4, 3, 2, 1, 0))
levels(t_ra_data$Ordinal3)

 #Ra_T
mosaic_t_ra<- ggplot(data = t_ra_data) +
geom_mosaic(aes(weight = 1, x = product(Ordinal3, set_num), fill=Ordinal3), na.rm=TRUE) +  
scale_fill_brewer(type="seq", palette= Palette, direction=-1) +
labs(x="Trial number ", title='Interest scores by trial number') + 
labs(title =  " 0-chuck P. pustulosus / R. alata") +
theme(plot.title = element_text(face="italic", size=29.5)) + #this makes the plot title italic, affects the size
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),  axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) + #this gets rid of grey background and lines, adds y+x axes lines
guides(fill=guide_legend(title = "Interest Score", reverse = TRUE)) 
mosaic_t_ra 
# alternate palette "YlGnBu"


ggsave("t_ra_trial_mosaic.pdf", height =5, width = 7)  
  
#axis.text.y=element_blank(),

```

[tia_tib_tia]
```{r}
      
        #making a plot for the entire of one treatment, with each set getting a boxplot
        
        #tia
        tia_data <- t.d.[t.d.$trial_name_2=="tia_tib_tia", ]       
        p_tia <- ggplot(data = tia_data, aes(x = set_num, y = as.numeric(Ordinal3)))      
        p_tia <- p_tia + geom_boxplot(aes(fill=factor(set_num)))
        #p_tia <- p_tia + geom_point(position = position_jitter(width = 0.1))
        p_tia<- p_tia + guides(fill=FALSE)
        p_tia<- p_tia + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c(T1c, T1c, T1c, T1c, T1c, T1c, T1c))
       # p_tia<- p_tia + ylab(element_blank())
       #p_tia <- p_tia + xlab(element_blank())
        p_tia <- p_tia + labs(title =  " Different individual P. pustulosus") +
             theme(plot.title = element_text(face="italic", size=33)) #this makes the plot title italic, affects the size
         p_tia <- p_tia + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.y=element_blank(), axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) #this gets rid of grey background and lines, adds 2 axes
        p_tia <- p_tia + coord_cartesian(ylim = c(0,5))
        
        p_tia
 ggsave("tia_trial_ordinal.jpg", height =5, width = 7)             
```

mosaic tia
```{r}
# Attempt at a mosaic plot
str(tia_data$Ordinal3)
levels(tia_data$Ordinal3)

#I'm reversing the ordering of the Ordinal factor, just for plotting, because I think it looks clearer/ more like habituation if the lowest interest score is on the top. 
tia_data$Ordinal3<- factor(tia_data$Ordinal3, levels = c(4, 3, 2, 1, 0))
levels(tia_data$Ordinal3)

 #Ra_T
mosaic_tia<- ggplot(data = tia_data) +
geom_mosaic(aes(weight = 1, x = product(Ordinal3, set_num), fill=Ordinal3), na.rm=TRUE) +  
scale_fill_brewer(type="seq", palette= Palette, direction=-1) +
labs(x="Trial number ", title='Interest scores by trial number') + 
labs(title =  "Different individual P. pustulosus") +
theme(plot.title = element_text(face="italic", size=33)) + #this makes the plot title italic, affects the size
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),  axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) + #this gets rid of grey background and lines, adds y+x axes lines
guides(fill=guide_legend(title = "Interest Score", reverse = TRUE)) 
mosaic_tia 
# alternate palette "YlGnBu"


ggsave("tia_trial_mosaic.pdf", height =5, width = 7)  
  
#axis.text.y=element_blank(),

```

#### [ts_tc_ts]
```{r}
      
  
        #ts_tc
        ts_data <- t.d.[t.d.$trial_name_2=="ts_tc_ts", ] 

```

```{r}
        p_ts <- ggplot(data = ts_data, aes(x = set_num, y = as.numeric(Ordinal3)))      
        p_ts <- p_ts + geom_boxplot(aes(fill=factor(set_num)))
        #p_ts <- p_ts + geom_point(position = position_jitter(width = 0.1))
        p_ts<- p_ts + guides(fill=FALSE)
        p_ts<- p_ts + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c(Ts, Ts, Ts, Ts, Ts, T2c, Ts))
       # p_ts<- p_ts + ylab(element_blank())
       #p_ts <- p_ts + xlab(element_blank())
        p_ts <- p_ts + labs(title =  "0-chuck  / 2-chuck P. pustulosus") +
             theme(plot.title = element_text(face="italic", size=33)) #this makes the plot title italic, affects the size
         p_ts <- p_ts + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.y=element_blank(), axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) #this gets rid of grey background and lines, adds 2 axes
        p_ts <- p_ts + coord_cartesian(ylim = c(0,5))
        
        p_ts
 ggsave("ts_trial_ordinal.jpg", height =5, width = 7)             
```

mosaic ts
```{r}
# Attempt at a mosaic plot
str(ts_data$Ordinal3)
levels(ts_data$Ordinal3)

#I'm reversing the ordering of the Ordinal factor, just for plotting, because I think it looks clearer/ more like habituation if the lowest interest score is on the top. 
ts_data$Ordinal3<- factor(ts_data$Ordinal3, levels = c(4, 3, 2, 1, 0))
levels(ts_data$Ordinal3)

 
mosaic_ts<- ggplot(data = ts_data) +
geom_mosaic(aes(weight = 1, x = product(Ordinal3, set_num), fill=Ordinal3), na.rm=TRUE) +  
scale_fill_brewer(type="seq", palette= Palette, direction=-1) +
labs(x="Trial number ", title='Interest scores by trial number') + 
labs(title =  "0-chuck  / 2-chuck P. pustulosus") +
theme(plot.title = element_text(face="italic", size=33)) + #this makes the plot title italic, affects the size
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),  axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) + #this gets rid of grey background and lines, adds y+x axes lines
guides(fill=guide_legend(title = "Interest Score", reverse = TRUE)) 
mosaic_ts 
# alternate palette "YlGnBu"


ggsave("ts_trial_mosaic.pdf", height =5, width = 7)  
  
#axis.text.y=element_blank(),

```



###[tc_ts_tc]

tc data
```{r}
      
  
        ##tc
        tc_data <- t.d.[t.d.$trial_name_2=="tc_ts_tc", ]  
```

```{r}
        p_tc <- ggplot(data = tc_data, aes(x = set_num, y = as.numeric(Ordinal3)))      
        p_tc <- p_tc + geom_boxplot(aes(fill=factor(set_num)))
        #p_tc <- p_tc + geom_point(position = position_jitter(width = 0.1))
        p_tc<- p_tc + guides(fill=FALSE)
        p_tc<- p_tc + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c(T2c, T2c, T2c, T2c, T2c, Ts, T2c))
       # p_tc<- p_tc + ylab(element_blank())
       #p_tc <- p_tc + xlab(element_blank())
        p_tc <- p_tc + labs(title =  "2-chuck / 0-chuck P. pustulosus") +
             theme(plot.title = element_text(face="italic", size=33)) #this makes the plot title italic, affects the size
         p_tc <- p_tc + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.y=element_blank(), axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) #this gets rid of grey background and lines, adds 2 axes
        p_tc <- p_tc + coord_cartesian(ylim = c(0,5))
        
        p_tc
 #ggsave("tc_trial_ordinal.jpg", height =5, width = 7)             
```


mosaic tc
```{r}
# Attempt at a mosaic plot
str(tc_data$Ordinal3)
levels(tc_data$Ordinal3)

#I'm reversing the ordering of the Ordinal factor, just for plotting, because I think it looks clearer/ more like habituation if the lowest interest score is on the top. 
tc_data$Ordinal3<- factor(tc_data$Ordinal3, levels = c(4, 3, 2, 1, 0))
levels(tc_data$Ordinal3)

#plot
mosaic_tc<- ggplot(data = tc_data) +
geom_mosaic(aes(weight = 1, x = product(Ordinal3, set_num), fill=Ordinal3), na.rm=TRUE) +  
scale_fill_brewer(type="seq", palette= Palette, direction=-1) +
labs(x="Trial number ", title='Interest scores by trial number') + 
labs(title =  "2-chuck / 0-chuck P. pustulosus") +
theme(plot.title = element_text(face="italic", size=33)) + #this makes the plot title italic, affects the size
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),  axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) + #this gets rid of grey background and lines, adds y+x axes lines
guides(fill=guide_legend(title = "Interest Score", reverse = TRUE)) 
mosaic_tc 
# alternate palette "YlGnBu"


ggsave("tc_trial_mosaic.pdf", height =5, width = 7)  
  
#axis.text.y=element_blank(),

```

[rt_rra_rt]
```{r}
      
        #making a plot for the entire of one treatment, with each set getting a boxplot
        
        #rt
        rt_data <- t.d.[t.d.$trial_name_2=="rt_rra_rt", ]       
        p_rt <- ggplot(data = rt_data, aes(x = set_num, y = as.numeric(Ordinal3)))      
        p_rt <- p_rt + geom_boxplot(aes(fill=factor(set_num)))
        #p_rt <- p_rt + geom_point(position = position_jitter(width = 0.1))
        p_rt<- p_rt + guides(fill=FALSE)
        p_rt<- p_rt + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c(Rt, Rt, Rt, Rt, Rt, Rra, Rt))
       # p_rt<- p_rt + ylab(element_blank())
       #p_rt <- p_rt + xlab(element_blank())
        p_rt <- p_rt + labs(title =  "Rev. P. pustulosus / Rev. R. alata") +
             theme(plot.title = element_text(face="italic", size=33)) #this makes the plot title italic, affects the size
         p_rt <- p_rt + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.y=element_blank(), axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) #this gets rid of grey background and lines, adds 2 axes
        p_rt <- p_rt + coord_cartesian(ylim = c(0,5))
        
        p_rt
 ggsave("rt_trial_ordinal.jpg", height =5, width = 7)             
```


mosaic rt
```{r}
# Attempt at a mosaic plot
str(rt_data$Ordinal3)
levels(rt_data$Ordinal3)

#I'm reversing the ordering of the Ordinal factor, just for plotting, because I think it looks clearer/ more like habituation if the lowest interest score is on the top. 
rt_data$Ordinal3<- factor(rt_data$Ordinal3, levels = c(4, 3, 2, 1, 0))
levels(rt_data$Ordinal3)

 #Ra_T
mosaic_rt<- ggplot(data = rt_data) +
geom_mosaic(aes(weight = 1, x = product(Ordinal3, set_num), fill=Ordinal3), na.rm=TRUE) +  
scale_fill_brewer(type="seq", palette= Palette, direction=-1) +
labs(x="Trial number ", title='Interest scores by trial number') + 
labs(title =  "Rev. P. pustulosus / Rev. R. alata") +
theme(plot.title = element_text(face="italic", size=33)) + #this makes the plot title italic, affects the size
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),  axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) + #this gets rid of grey background and lines, adds y+x axes lines
guides(fill=guide_legend(title = "Interest Score", reverse = TRUE)) 
mosaic_rt 
# alternate palette "YlGnBu"


ggsave("rt_trial_mosaic.pdf", height =5, width = 7)  
  
#axis.text.y=element_blank(),

```

[rra_rt_rra]
```{r}
      
        #making a plot for the entire of one treatment, with each set getting a boxplot
        
        #rra
        rra_data <- t.d.[t.d.$trial_name_2=="rra_rt_rra", ]       
        p_rra <- ggplot(data = rra_data, aes(x = set_num, y = as.numeric(Ordinal3)))      
        p_rra <- p_rra + geom_boxplot(aes(fill=factor(set_num)))
        #p_rra <- p_rra + geom_point(position = position_jitter(width = 0.1))
        p_rra<- p_rra + guides(fill=FALSE)
        p_rra<- p_rra + scale_x_continuous(breaks = c(1,2,3,4,5,6,7)) +
              scale_fill_manual(breaks = c("1", "2", "3", "4", "5", "6", "7"),
                                values=c(Rt, Rt, Rt, Rt, Rt, Rra, Rt))
       # p_rra<- p_rra + ylab(element_blank())
       #p_rra <- p_rra + xlab(element_blank())
        p_rra <- p_rra + labs(title =  "Rev. R. alata / Rev. P. pustulosus") +
             theme(plot.title = element_text(face="italic", size=33)) #this makes the plot title italic, affects the size
         p_rra <- p_rra + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"), axis.text.y=element_blank(), axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) #this gets rid of grey background and lines, adds 2 axes
        p_rra <- p_rra + coord_cartesian(ylim = c(0,5))
        
        p_rra
 ggsave("rra_trial_ordinal.jpg", height =5, width = 7.5)             
```


mosaic rra
```{r}
# Attempt at a mosaic plot
str(rra_data$Ordinal3)
levels(rra_data$Ordinal3)

#I'm reversing the ordering of the Ordinal factor, just for plotting, because I think it looks clearer/ more like habituation if the lowest interest score is on the top. 
rra_data$Ordinal3<- factor(rra_data$Ordinal3, levels = c(4, 3, 2, 1, 0))
levels(rra_data$Ordinal3)

 #Ra_T
mosaic_rra<- ggplot(data = rra_data) +
geom_mosaic(aes(weight = 1, x = product(Ordinal3, set_num), fill=Ordinal3), na.rm=TRUE) +  
scale_fill_brewer(type="seq", palette= Palette, direction=-1) +
labs(x="Trial number ", title='Interest scores by trial number') + 
labs(title =  "Rev. R. alata / Rev. P. pustulosus") +
theme(plot.title = element_text(face="italic", size=33)) + #this makes the plot title italic, affects the size
theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"),  axis.text.x = element_text( size = 40), axis.title.x=element_blank(),
          axis.title.y=element_blank()) + #this gets rid of grey background and lines, adds y+x axes lines
guides(fill=guide_legend(title = "Interest Score", reverse = TRUE)) 
mosaic_rra 
# alternate palette "YlGnBu"


ggsave("rra_trial_mosaic.pdf", height =5, width = 7)  
  
#axis.text.y=element_blank(),

```


### Attention set 5- "space to move?"
[data wrangling]
```{r}
 t.d.just5<- subset(t.d., t.d.$set_num=="5")
head(t.d.just5)
```

model
```{r}
##

trial5mod<- clmm(Ordinal3 ~ primary_stim + (trial_number|Bat_ID), Hess=TRUE, data = t.d.just5) 
s.trial5mod<- summary(trial5mod)
s.trial5mod
lst_5mod<-cld(lsmeans(trial5mod, ~primary_stim))
lst_5mod



##

```

Plotting set 5::

```{r}

trial5mod<- clmm(Ordinal3 ~ primary_stim -1 + (trial_number|Bat_ID), Hess=TRUE, data = t.d.just5) 
s.trial5mod<- summary(trial5mod)
s.trial5mod
lst_5mod<-cld(lsmeans(trial5mod, ~primary_stim))
lst_5mod


```

```{r}
 t.d.just5$primary_stim <- factor(t.d.just5$primary_stim,levels = c("ts" ,"t1c", "t2c" , "de", "ra" , "rra","rt" ),ordered = TRUE)

p5<- ggplot(data = t.d.just5, aes(x = primary_stim, y = as.numeric(Ordinal3), fill=primary_stim))
p5<- p5+ geom_boxplot()
p5<- p5+ geom_point(position = position_jitter(width = 0.1))
p5<- p5+ theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") #format x-axis, and remove side legend

p5<- p5+ scale_x_discrete(labels=c("0c P. pustulosus","1c P. pustulosus","2c pustulosus","D. ebraccatus", "R. alata", "rev R. alata", "rev P. pustulosus"))  +
              scale_fill_manual(breaks = c("0c P. pustulosus","1c P. pustulosus","2c pustulosus","D. ebraccatus", "R. alata", "rev R. alata", "rev P. pustulosus"),
                                values=c(Ts, T1c, T2c, De, Ra, Rra, Rt))
p5<- p5+ theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),
panel.background = element_blank(), axis.line = element_line(colour = "black"))  #gets rid of background


p5<- p5+ xlab("Acoustic stimuli")
p5<- p5+ ylab("Responses in trial 5")
p5
#ggsave("Ordinal Response in set 5.jpg", width = 3, height = 4)
#ggsave("CI_comparison_final.png",width=5)
```

mosaic trial 5 :
```{r}
## 
t.d.just5_a <-  t.d.just5
t.d.just5_a$primary_stim <- factor(t.d.just5$primary_stim,levels = c("ts" ,"t1c", "t2c" , "de", "ra" , "rra","rt" ),ordered = TRUE)
 #I'm reversing the ordering of the Ordinal factor, just for plotting, because I think it looks clearer/ more like habituation if the lowest interest score is on the top. 


t.d.just5_a$Ordinal3<- factor(t.d.just5_a$Ordinal3, levels = c(4, 3, 2, 1, 0))
t.d.just5_a$Ordinal3<- factor(t.d.just5_a$Ordinal3, ordered= FALSE)
levels(t.d.just5_a$Ordinal3)
class(t.d.just5_a$primary_stim)   ##R
 #Ra_T
  mosaic_just5<- ggplot(data = t.d.just5_a) +
   geom_mosaic(aes(weight = 1, x = product(Ordinal3, primary_stim), fill=Ordinal3), na.rm=TRUE) +  
   scale_fill_brewer(type="seq", palette= Palette, direction=-1) +
  # scale_x_continuous(breaks=c("ts",  "t1c", "t2c", "de",  "ra",  "rra", "rt" ),
     #   labels=c("0c P. pustulosus","1c P. pustulosus","2c pustulosus","D. ebraccatus", "R. alata", "rev R. alata", "rev P. pustulosus"))+
  
          theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(), panel.background = element_blank(), axis.line = element_line(colour = "black")) + #this gets rid of grey background and lines, adds y+x axes lines
        labs(x="Acoustic stimuli ", y= "Interest score in trial 5") +
        guides(fill=guide_legend(title = "Interest Score", reverse = TRUE)) 
  mosaic_just5

  #worry about axis later. 
 
#ggsave("set5_interest_mosaic.pdf", width = 6.5, height = 5.55)
```



Investigate correlation between initial interest and slope more formally?
```{r}
sv_int_nbc<- cld(int_lsmeans, sort=FALSE)
sv_int_nbc

svlstx<-cld(lst, sort=FALSE)
svlstx$primary_stim <- factor(svlstx$primary_stim,levels = c("ts", "t1c", "t2c", "de", "ra", "rra", "rts" ),ordered = TRUE)
svlstx

trt<- c("de",
"ts",
"t1c",
"t2c",
"ra",
"rt",
"rra")

int_est<- c(1.707,
1.777,
1.709,
2.201,
2.029,
1.892,
2.614)

slope_esti<-c(-0.228,
-0.258,
-0.146,
-0.026,
-1.015,
-0.362,
-0.811)

int_slope_cor<- as.data.frame(cbind(trt, int_est, slope_esti))
int_slope_cor

ggplot

p_i_s<-ggplot(data=int_slope_cor, aes(x = slope_esti, y=int_est)) +
      geom_point()+
      stat_smooth(colour="black") 

p_i_s

```

What would I have found if I had just looked at total twitches throughout the entire trial?
```{r}
#import dataset from github
bat_data<-read.table("https://raw.githubusercontent.com/maydixon/Attn_Project/master/attn_habit_4.txt", sep="\t", header=TRUE) #web
#* local:
#bat_data<-read.table("/Users/maydixon/GitHub/Attn_Project/Attn_project_github/attn_habit_4.txt", sep="\t", header=TRUE) #local

bat_data<- subset(bat_data, bat_data$bat_name != "Blackbeard" ) #removes unresponsive bat

      
        
        # want just one line for each "treatment"
        #pull partial string match  1.1 for call number using grep
        attn_trial <- bat_data[grep("1.1", bat_data$call_num), ]
        
        #make column with all the twitches per each trial
        attn_trial$all_tw_trial<- attn_trial$sm_tw_trial + attn_trial$md_tw_trial + attn_trial$lg_tw_trial
    
 #MOD:
    
tw_trial_mod<- glmer(all_tw_trial ~ primary_stim -1 + (trial_number|Bat_ID), data =attn_trial, family = "poisson")       
sum_trial_mod<- summary(tw_trial_mod)
sum_trial_mod   
ls_trial<-lsmeans::lsmeans(tw_trial_mod, ~primary_stim)
ls_trial
sig_lstrial<-cld(ls_trial)
sig_lstrial
plot(sig_lstrial, comparisons=TRUE, alpha = 0.05)


gg_trial<- ggplot(data=attn_trial, aes(x=primary_stim, y=all_tw_trial, fill=primary_stim)) +
      geom_boxplot()

gg_trial

ggsave("twitches_per_trial.jpg", width = 7, height = 5)

```

So, these results are a bit jumbled, DE and t2c have the most twitches overall, followed by reversed rhinella alata, the various other tungaras, and the other rhinella is last.  
## Other patterns over the course of the trials
#####small twitch trends with trials
```{r}
smalltwitchtrial <-ggplot(data=t.d., aes(x=set_num, y=sm_tw_set))
smalltwitchtrial <- smalltwitchtrial + geom_point(position = position_jitter(width = 0.1))
smalltwitchtrial
```

#####medium large twitch trends with trials
```{r}
mdlgtwitchtrial <-ggplot(data=t.d., aes(x=set_num, y=mdlg_tw_set))
mdlgtwitchtrial <- mdlgtwitchtrial + geom_point(position = position_jitter(width = 0.1))
mdlgtwitchtrial
```
####Med twitch trends with trials
```{r}
medtwitch.trialplot <-ggplot(data=t.d., aes(x = set_num, y = md_tw__set, color=primary_stim))
medtwitch.trialplot <- medtwitch.trialplot + geom_point(position = position_jitter(width = 0.1))
medtwitch.trialplot
```

##### large twitch trends with trials
```{r}
lgtwitchtrial <-ggplot(data=t.d., aes(x=set_num, y=lg_tw_set))
lgtwitchtrial <- lgtwitchtrial + geom_point(position = position_jitter(width = 0.1))
lgtwitchtrial
```
Orient trend with trials
```{r}
orient.trialplot <-ggplot(data=t.d., aes(x = set_num, y = Orienting_set, color=primary_stim))
orient.trialplot <- orient.trialplot + geom_point(position = position_jitter(width = 0.1))
orient.trialplot
```
Approach trend with trials
```{r}
approach.trialplot <-ggplot(data=t.d., aes(x = set_num, y = Approach_set, color=primary_stim))
approach.trialplot <- approach.trialplot + geom_point(position = position_jitter(height=0.05, width = 0.05))
approach.trialplot
```

Ordinal#1 trend with trials
```{r}
Ordinal.trialplot <-ggplot(data=t.d., aes(x = set_num, y = Ordinal, color=primary_stim))
Ordinal.trialplot <- Ordinal.trialplot + geom_point(position = position_jitter(height=0.05, width = 0.05))
Ordinal.trialplot
```
Ordinal#2 trial plots
```{r}
Ordinal2.trialplot <-ggplot(data=t.d., aes(x = set_num, y = Ordinal2, color=primary_stim))
Ordinal2.trialplot <- Ordinal2.trialplot + geom_point(position = position_jitter(height=0.05, width = 0.05))
Ordinal2.trialplot
```
Ordinal#3 trial plot

```{r}
Ordinal3.trialplot <-ggplot(data=t.d., aes(x = set_num, y = Ordinal3, color=primary_stim))
Ordinal3.trialplot <- Ordinal3.trialplot + geom_point(position = position_jitter(height=0.05, width = 0.05))
Ordinal3.trialplot
```




some interesting side associations
```{r}

#relation between twitching and flying 
fltplot<- ggplot(data = t.d., aes(x = Ordinal, y = Flying_trial))
fltplot<- fltplot+ geom_point()
fltplot

#relation between twitching and grooming 
grmplot<- ggplot(data = t.d., aes(x = Ordinal, y = Grooming_trial))
grmplot<- grmplot+ geom_point()
grmplot

#relation between twitching and yawning
ywnplot<- ggplot(data = t.d., aes(x = Ordinal, y = Yawning_trial))
ywnplot<- ywnplot+ geom_point()
ywnplot

```